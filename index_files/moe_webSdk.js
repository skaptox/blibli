/*!
 * MoEngage Web SDK
 * v2.5.5
 */
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=41)}([function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},a=this;Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);t.isObjectEmpty=function(e){return 0===Object.keys(e).length&&e.constructor===Object},t.getProp=function e(t,n,r){return null==t?null:(t=t[(n=Array.isArray(n)?n:n.split("."))[0]])&&1<n.length?e(t,n.slice(1),r):void 0===t?r||null:t},t.getCurrentProtocol=function(){if(window){if("localhost"===window.location.hostname)return"https";if("http:"===window.location.protocol)return"http";if("https:"===window.location.protocol)return"https"}},t.stringToBuffer=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r},t.bufferToString=function(e){for(var t,n="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=new Uint8Array(e),a=o.byteLength,i=a%3,u=a-i,s=0;s<u;s+=3)n+=r[(16515072&(t=o[s]<<16|o[s+1]<<8|o[s+2]))>>18]+r[(258048&t)>>12]+r[(4032&t)>>6]+r[63&t];return 1==i?n+=r[(252&(t=o[u]))>>2]+r[(3&t)<<4]+"==":2==i&&(n+=r[(64512&(t=o[u]<<8|o[1+u]))>>10]+r[(1008&t)>>4]+r[(15&t)<<2]+"="),n},t.isVapid=function(e,t){return t.isChrome()||t.isOpera()?"vapid"===e.chrome.subscriptionMode&&!!e.chrome.vapidPublicKey:!!t.isFirefox()&&"vapid"===e.firefox.subscriptionMode&&!!e.firefox.vapidPublicKey},t.getVapidPublicKey=function(e,t){return t.isChrome()||t.isOpera()?e.chrome.vapidPublicKey:t.isFirefox()?e.firefox.vapidPublicKey:""},t.isMobile=function(){var e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))},t.parseISOString=function(e){return new Date(Date.parse(e))},t.asyncForEach=function(e,t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:n=0,r.label=1;case 1:return n<e.length?[4,t(e[n],n,e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.getMoeWindowVar=function(){return window[window.moengage_object||"Moengage"]},t.PromiseObject=function(){var e=this;this.p=null,this.res=null,this.rej=null;try{this.p=new Promise((function(t,n){e.res=t,e.rej=n}))}catch(e){i.default.error(1,"Utils.PromiseObject","Promises not supported")}},t.validateDataType={isBoolean:function(e){return"boolean"==typeof e},isNumber:function(e){return"number"==typeof e},isString:function(e){return"string"==typeof e},isNumeric:function(e){return a.isNumber(e)||a.isString(e)&&String(+e)===e},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)}},t.deepCompareObjects=function e(t,n){if(null==t||null==n)return t===n;if(t instanceof Function)return t===n;if(t instanceof RegExp)return t===n;if(t===n||t.valueOf()===n.valueOf())return!0;if(Array.isArray(t)&&t.length!==n.length)return!1;if(t instanceof Date)return!1;if(!(t instanceof Object))return!1;if(!(n instanceof Object))return!1;var r=Object.keys(t);return Object.keys(n).every((function(e){return-1!==r.indexOf(e)}))&&r.every((function(r){return e(t[r],n[r])}))},t.deserializeQueryParams=function(e){if(e){var t=e.replace("?","").split("&"),n={};return t.forEach((function(e){var t=e.split("="),r=t[0],o=decodeURIComponent(t[1]||"");n[r]?"[object Array]"===Object.prototype.toString.call(n[r])?n[r].push(o):n[r]=[n[r],o]:n[r]=o})),JSON.parse(JSON.stringify(n))}return{}},t.debounce=function(e,t,n){var r=0;return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var i=this,u=n&&!r;clearTimeout(r),r=setTimeout((function(){r=null,n||e.apply(i,o)}),t),u&&e.apply(i,o)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=(a.EPHEMERAL_STORAGE={INIT_DATA:"initData",BROWSER_DETAILS:"browserDetails",UNIFIED_LOGS:"unifiedLogs"},a.PERSISTENT_STORAGE={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION"},a.COOKIE_STORAGE={SESSION_COOKIE:{EXPIRY_YEARS:2}},a.EVENT_NAMES={USER_ATTRIBUTE:"EVENT_ACTION_USER_ATTRIBUTE",UNSUBSCRIBED:"MOE_WEB_UNSUBSCRIBED",WEB_SESSION_START:"EVENT_ACTION_WEB_SESSION_START",PAGE_VIEWED:"MOE_PAGE_VIEWED",WEB_OPTIN_BANNER_LOAD:"MOE_WEB_OPTIN_BANNER_LOAD",WEB_OPTIN_CLOSED:"MOE_WEB_OPTIN_CLOSED",WEB_OPTIN_ACCEPTED:"MOE_WEB_OPTIN_ACCEPTED",USER_SUBSCRIBED:"MOE_USER_SUBSCRIBED",OPT_IN_SHOWN:"MOE_OPT_IN_SHOWN",OPT_IN_ALLOWED:"MOE_OPT_IN_ALLOWED",OPT_IN_DISMISSED:"MOE_OPT_IN_DISMISSED",OPT_IN_BLOCKED:"MOE_OPT_IN_BLOCKED",USER_SUBSCRIPTION_CHECK:"MOE_USER_SUBSCRIPTION_CHECK",LOGOUT:"MOE_LOGOUT",UPDATE_DEVICE_ATTRIBUTE:"EVENT_ACTION_DEVICE_ATTRIBUTE"},a.EVENT_ATTRIBUTES_NAMES={URL:"URL",LOGGED_IN_STATUS:"moe_logged_in_status",FIRST_VISIT:"moe_first_visit"},a.ATTRIBUTE_NAMES={ID:"USER_ATTRIBUTE_UNIQUE_ID",EMAIL:"USER_ATTRIBUTE_USER_EMAIL",NAME:"USER_ATTRIBUTE_USER_NAME",FIRST_NAME:"USER_ATTRIBUTE_USER_FIRST_NAME",LAST_NAME:"USER_ATTRIBUTE_USER_LAST_NAME",MOBILE:"USER_ATTRIBUTE_USER_MOBILE",GENDER:"USER_ATTRIBUTE_USER_GENDER",BDAY:"USER_ATTRIBUTE_USER_BDAY",ID_MODIFIED:"USER_ID_MODIFIED_FROM"},a.SDK_FEATURES={WEB_PUSH:"WEB_PUSH"},a.BROADCAST_TOPICS={MOE_LIFECYCLE:{TOPIC_NAME:"MOE_LIFECYCLE",EVENT_NAMES:{MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED"}},OPT_IN_LIFECYCLE:{TOPIC_NAME:"MOE_OPT_IN",EVENT_NAMES:{HARD_ASK_SHOWN:"HARD_ASK_SHOWN",HARD_ASK_DISMISSED:"HARD_ASK_DISMISSED",HARD_ASK_ALLOWED:"HARD_ASK_ALLOWED",HARD_ASK_DENIED:"HARD_ASK_DENIED",SOFT_ASK_SHOWN:"SOFT_ASK_SHOWN",SOFT_ASK_DISMISSED:"SOFT_ASK_DISMISSED",SOFT_ASK_ALLOWED:"SOFT_ASK_ALLOWED"}},INAPP_LIFECYCLE:{TOPIC_NAME:"INAPP_LIFECYCLE",EVENT_NAMES:{MODULE_LOADED:"MODULE_LOADED"}}},a.ERRORS={WEB_PUSH_NOT_SUPPORTED:{code:1e3,reason:"Web push not supported in current browser environment"},SERVICE_WORKER_REGISTRATION_FAILED:{code:1001,reason:"Registering the service worker failed"},WEB_PUSH_NOT_CONFIGURED:{code:1002,reason:"Web push settings not configured"},NOTIFICATION_MANAGER_NOT_CONFIGURED:{code:1003,reason:"Could not configure a notification manager for the current browser and settings"},PERMISSION_DISMISSED_TOO_MANY_TIMES:{code:1004,reason:"Hard ask was dismissed to many times"},SERVICE_WORKER_NOT_IN_CORRECT_SCOPE:{code:1005,reason:"Service worker can not be registered on this page due to scope issues"}},a.HTML_COMM={CHANNEL:{MAIN:"moe",SUBD:"moe-subd"},TOPICS:{PERSISTENT_STORAGE:"STORAGE",EPHEMERAL_STORAGE:"EPHEMERAL_STORAGE",PERMISSION_STATE:"PERMISSION_STATE",CONFIG:"CONFIG",HARD_ASK_RESULT:"HARD_ASK_RESULT",SHOW_NOTIF:"SHOW_NOTIF"}},a.GIFS={AMAZED:"https://media.giphy.com/media/90F8aUepslB84/giphy.gif",SAD:"https://media.giphy.com/media/KDRv3QggAjyo/giphy.gif"},a.CLUSTER_ENVIRONMENT_MAP={in:"sdk-serv3",eu:"apiv2eu"},a.LINKS={MOE_DASHBOARD:"https://app.moengage.com",MIGRATION_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",WEBSDK_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",SELF_HANDLED_DOCS:"https://docs.moengage.com/docs/self-handled-opt-ins"},a.WEB_SDK_API_MAX_RETRIES=3,a.ADD_REPORT_API_MAX_RETRIES=3,a.SESSION_SOURCE={SESSION:"SESSION",SESSION_KEY:"sessionKey",SESSION_START_TIME:"sessionStartTime",SESSION_EXPIRY_TIME:"sessionExpiryTime",SESSION_MAX_TIME:"sessionMaxTime",SESSION_ENABLED:"sessionEnabled",CUSTOM_IDENTIFIERS_TO_TRACK:"customIdentifiersToTrack",CURRENT_SOURCE:"currentSource",NUMBER_OF_SESSIONS:"numberOfSessions"},a.CONFIG={HOST:"https://apiv2.moengage.com/",API:{META:"v3/sdkconfig/"}},a.EVENTS={DATABASE_NAME:"moe_tracking",STORE_NAME:"events"},a.AMP={UUID:"moe_uuid"},a.BRANCH="master",a);function a(){}t.default=o,t.WINDOW_OBJECTS={PageEventHistroyManager:"MoengagePageEventHistroyManager"},t.INAPP_CONSTANTS={HOST:"https://inapps.moengage.com/",HOST_IN:"https://inapps-serv3.moengage.com/",HOST_EU:"https://inapps-eu.moengage.com/",API:{META:"v3/campaigns/inapp/live",CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/live/",DRAFT_CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/test/"},DRAFT_CAMPAIGN_TPYES:{WEB_PERSONALIZATON:"web_personalization",ONSITE_MESSAGING:"onsite_messaging"},META_REFRESH_TIME:9e5,DATABASE_NAME:"moe_onsite",STORES:{CAMPAIGNS_META:{NAME:"campaigns_meta"},CAMPAIGNS_TAGS:{NAME:"campaigns_tags"},CAMPAIGNS_STATS:{NAME:"campaigns_stats"},TEST_CAMPAIGN_STORE:{NAME:"test_campaign"},SERVICE_META:{NAME:"service_meta",KEYS:{LAST_META_CALL_TIME:"last_meta_call_time",GLOBAL_DELAY:"global_delay_between_inapps",LAST_INAPP_SHOWN_TIME:"last_inapp_shown",LAST_FETCH_SDK_VERSION:"last_fetch_sdk_version",UNIQUE_ID:"unique_id"}}},EVENT_NAMES:{OSM:{CLICK:"MOE_ONSITE_MESSAGE_CLICKED",IMPRESSION:"MOE_ONSITE_MESSAGE_SHOWN",DISMISS:"MOE_ONSITE_MESSAGE_DISMISSED",AUTO_DISMIS:"MOE_ONSITE_MESSAGE_AUTO_DISMISS",TYPE:"onsite"},WP:{CLICK:"MOE_WEBP_MESSAGE_CLICKED",IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",DISMISS:"MOE_WEBP_MESSAGE_DISMISSED",DELIVERED:"MOE_WEBP_MESSAGE_DELIVERED",TYPE:"webp"}},WEB_HELPER_IFRAME_URL:"https://cdn.moengage.com/webpush/beta/webpushhelper.html",IFRAME_CHANNEL:"inapp_helper",IFRAME_TOPICS:{COOKIE_STORAGE:"COOKIE_STORAGE"},COOKIE_STORAGE:{TEST_DRAFT_TYPE:"moe_inapp_draft_type",TEST_DRAFT_ID:"moe_inapp_draft_id",TEST_DRAFT_TAG:"moe_inapp_draft_tag",TEST_CAMPAIGN_META:"test_campaign_meta",TEST_TEMPLATE_TYPE:"test_template_type"},CSS_SELECTORS:{CLICK_INAPP:"moe-inapp-click",DISMISS_INAPP:"moe-inapp-close"},EXIT_INTENT:{CONFIG:{SCROLL_DOWN_THRESHOLD:50,SCROLL_UP_THRESHOLD:5,SCROLL_INTERVAL:1e3}},POSITIONED_TEMPLATE:'data-editor-type="MOE_EDITOR"'},t.SDK_MODULES={INAPP:{name:"INAPP",src:"https://cdn.moengage.com/webpush/modules/inapp.js",windowLocation:"moeOnsite"}},(r=t.SESSION_SOURCE_STATUS||(t.SESSION_SOURCE_STATUS={})).BLOCKED="blocked",r.ALLOWED="allowed",t.DATA_TYPES={NUMBER:"number"},t.PAGE_LIFE_CYCLE={FIRST_SEEN_SESSIONS:1}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),i=n(1),u="color: white; background: #41AE55; border-radius: 5px;",s="color: white; background: #48beab; border-radius: 5px;",l=(c.setLogLevel=function(e,t){var n=c.baseLogTag+".setLogLevel";null==a.default.get(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS)&&a.default.set(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,[]),null==e?c.logLevel=0:e in[0,1,2]?0<(c.logLevel=e)&&t&&c.releaseAllLogs():c.warn(0,n,"Value",e,"not supported for setDebugLevel(). Current log level is",c.logLevel,". Debug level can only be [0, 1, 2]")},c.log=function(e,t,n){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];e<=c.logLevel?console.log.apply(console,o(["%c "+c.logBrand+" %c %c info %c %c "+t+" ",u,"","color: white; background: #18a0bf; border-radius: 5px;","",s,n],r)):c.cacheLog((function(){c.log.apply(c,o([e,t,n],r))}))},c.error=function(e,t,n){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];e<=c.logLevel?console.error.apply(console,o(["%c "+c.logBrand+" %c %c error %c %c "+t+" ",u,"","color: white; background: #cc0a0a; border-radius: 5px;","",s,n],r)):c.cacheLog((function(){c.error.apply(c,o([e,t,n],r))}))},c.warn=function(e,t,n){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];e<=c.logLevel?console.warn.apply(console,o(["%c "+c.logBrand+" %c %c warn %c %c "+t+" ",u,"","color: white; background: #e8ab51; border-radius: 5px;","",s,n],r)):c.cacheLog((function(){c.warn.apply(c,o([e,t,n],r))}))},c.customLabel=function(e,t,n){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];e<=c.logLevel?console.log.apply(console,o(["%c "+c.logBrand+" %c %c "+t+" %c %c "+n+" %c ",u,"",s,"","color: white; background: #a400ff; border-radius: 5px;",""],r)):c.cacheLog((function(){c.customLabel.apply(c,o([e,t,n],r))}))},c.image=function(e,t){e<=c.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):c.cacheLog((function(){c.image(e,t)}))},c.releaseAllLogs=function(){var e=a.default.get(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS),t=e.length,n=e;if(a.default.set(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,[]),0<t){c.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(var r=0;r<t;r++)n[r]();c.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}},c.setLogBrand=function(e){c.logBrand=e},c.setBrandColor=function(e){u="color: white; background: "+e+"; border-radius: 5px;"},c.cacheLog=function(e){var t=a.default.get(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS);null==t&&(t=[]),t.push(e),a.default.set(i.default.EPHEMERAL_STORAGE.UNIFIED_LOGS,t)},c.baseLogTag="Logger",c.logBrand="MoEngage",c.logLevel=0,c);function c(){}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0),a=n(1),i=n(13),u=n(12),s="MOE_DATA",l=(c.setPrefix=function(e){c.prefix=e+"_"},c.set=function(e,t){if(e=c.prefix+e,localStorage){var n=c.getMoeData();n[e]=t,localStorage.setItem(s,JSON.stringify(n))}c.isSharedWithCookie&&0<=c.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&u.default.set(e,t)},c.get=function(e){if(e=c.prefix+e,localStorage){var t=c.getMoeData();return o.getProp(t,e,null)}return null},c.remove=function(e){var t=c.baseLogTag+".remove",n=c.prefix+e;if(localStorage&&null!=c.get(e)){var o=c.getMoeData();delete o[n],localStorage.setItem(s,JSON.stringify(o)),r.default.log(2,t,"Key",e,"removed.")}c.isSharedWithCookie&&0<=c.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&u.default.remove(e)},c.logout=function(){var e=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA"];for(var t in a.default.PERSISTENT_STORAGE)e.indexOf(t)<0&&c.remove(a.default.PERSISTENT_STORAGE[t]);for(var n in a.default.PERSISTENT_STORAGE.Q)i.default.purge(n)},c.getString=function(e){if(e=c.prefix+e,localStorage){var t=c.get(e);return"string"==typeof t||t instanceof String?t:JSON.stringify(t)}},c.removePrefix=function(){c.prefix=""},c.copyKeysFromCookie=function(){for(var e=0;e<c.KEYS_SHARED_WITH_COOKIE.length;e++){var t=c.KEYS_SHARED_WITH_COOKIE[e];null!=u.default.get(t)&&c.set(t,u.default.get(t))}},c.getMoeData=function(){var e=c.baseLogTag+".getMoeData",t=localStorage.getItem(s);if(null==t)return{};try{return JSON.parse(t)}catch(t){return r.default.error(1,e,t),{}}},c.baseLogTag="PersistentStorage",c.prefix="",c.isSharedWithCookie=!1,c.KEYS_SHARED_WITH_COOKIE=[a.default.PERSISTENT_STORAGE.USER_DATA,a.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,a.default.PERSISTENT_STORAGE.SETUP_TIME,a.default.PERSISTENT_STORAGE.PUSH_TOKEN,a.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,a.default.PERSISTENT_STORAGE.HARD_ASK_STATUS],c);function c(){}t.default=l},function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,u)}s((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),u=n(1),s=n(17),l=n(2),c=n(13),f=n(0),d=n(27),S=n(3),E=n(7),g=n(10),p=n(20),_=n(9),h=n(8),T=(m.deviceAdd=function(){return new Promise((function(e,t){var n=g.default.get();return m.collectGetParams().then((function(r){var o={queryParams:r};s.default.post(n.baseDomainName+"v2/device/add",o).then((function(){h.default.get().then((function(t){t.deviceAdded=!0,t.save().then((function(){d.default.startPeriodicClear(u.default.PERSISTENT_STORAGE.Q.REPORT),m.onDeviceAdd.res(),e()}))}))})).catch((function(e){c.default.enqueue(u.default.PERSISTENT_STORAGE.Q.DEVICE,!0),t(!1)}))}))}))},m.reportAdd=function(e,t){var n=m.baseLogTag+".reportAdd";return new Promise((function(r,o){return t=!!t,m.getWebSDKSettings().then((function(o){o.isPushSubBilling?h.default.get().then((function(o){o.deviceAdded?m.reportAddInternal(e,t).then((function(){r(!0)})):(c.default.enqueue(u.default.PERSISTENT_STORAGE.Q.REPORT,e),l.default.log(1,n,"Report added to queue as device not added yet:",e.event.name),l.default.log(2,n,"Event Queued:",e.event.name),e.type===p.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&(m.isPushSubAttributeAccepted(e.event.attributes[0].key)?(l.default.log(1,n,"Attribute accepted for push sub billing."),m.deviceAdd()):l.default.log(2,n,"Attribute NOT accepted for push sub billing.")),r(!0))})):m.reportAddInternal(e,t).then((function(){r(!0)}))}))}))},m.reportAddInternal=function(e,t){var n=m.baseLogTag+".reportAddInternal";return new Promise((function(r,o){m.getWebSDKSettings().then((function(o){var a=g.default.get().baseDomainName;a+=t?"v2/device/add":"v2/report/add";var i=m.getUpdatedPushDetails();for(var f in i)e.getParams[f]=i[f];var S={queryParams:e.getParams,postData:e.postData};s.default.post(a,S).then((function(){e.type===p.default.REPORT_ADD_TYPE.EVENT?(l.default.log(1,n,"Event tracked successfully:",e.event),m.eventStore.setItem(e.event.name,e.event)):e.type===p.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&l.default.log(1,n,"User attribute added successfully:",e.event.attributes),m.addReportApiRetries=1,r()})).catch((function(t){l.default.error(1,n,"Add Report API failed",t),e.type===p.default.REPORT_ADD_TYPE.EVENT?l.default.log(1,n,"Queueing unsuccessful event tracking:",e.event):e.type===p.default.REPORT_ADD_TYPE.USER_ATTRIBUTE&&l.default.log(1,n,"Queueing unsuccessful user attribute add:",e.event.attributes),m.addReportApiRetries<u.default.ADD_REPORT_API_MAX_RETRIES&&setTimeout((function(){m.addReportApiRetries++,c.default.enqueue(u.default.PERSISTENT_STORAGE.Q.REPORT,e),d.default.startPeriodicClear(u.default.PERSISTENT_STORAGE.Q.REPORT)}),3e3*m.addReportApiRetries),r()}))}))}))},m.checkIfTokenValid=function(e){var t=g.default.get().baseDomainName+"v2/device/token-check",n=g.default.get();return new Promise((function(r){e?h.default.get().then((function(o){var a={queryParams:{app_id:n.appId,unique_id:o.deviceUuid,push_id:e}};s.default.post(t,a).then((function(e){200===e.status?r(!0):r(!1)})).catch((function(e){r(!1)}))})):r(!1)}))},m.getWebSDKSettings=function(){return new Promise((function(e,t){var n=g.default.get();if(null!=n&&null!=n.appId||(n=new g.default(S.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA))),m.sdkSettings)e(m.sdkSettings);else{var r=(new Date).getTime(),o=S.default.get(u.default.PERSISTENT_STORAGE.SETUP_TIME);null==o||0<n.debugLevel?m.getAndPersistWebSettings(n).then((function(t){e(t)})).catch((function(e){t(!1)})):864e5<r-o?m.getAndPersistWebSettings(n).then((function(t){e(t)})):S.default.get(u.default.PERSISTENT_STORAGE.WEB_SETTINGS)?(m.sdkSettings=S.default.get(u.default.PERSISTENT_STORAGE.WEB_SETTINGS),e(m.sdkSettings)):m.getAndPersistWebSettings(n).then((function(t){e(t)}))}}))},m.getAndPersistWebSettings=function(e){var t=this,n=m.baseLogTag+".getAndPersistWebSettings";return new Promise((function(i,c){return o(t,void 0,void 0,(function(){var t,o,d,E,p,h,T,v,b;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,6,,7]),null==e.appId&&(e=new g.default(S.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA))),t={queryParams:{app_id:e.appId}},l.default.log(1,n,"Fetching latest web sdk settings for",e.appId),[4,s.default.get(e.baseDomainName+"websdksettings",t)];case 1:o=a.sent(),l.default.log(1,n,"Fetching config settings for",e.appId),"string"==typeof(d=o.responseText)&&(d=JSON.parse(d)),E=f.isMobile()?"mweb":"web",p=e.baseDomainName+u.default.CONFIG.API.META+E+"/"+e.appId,a.label=2;case 2:return a.trys.push([2,4,,5]),[4,s.default.get(p)];case 3:return h=a.sent(),l.default.log(1,n,"Fetched latest web and config settings"),200===h.status&&(T=h.responseText,T=JSON.parse(T),d.webData=r({},d.webData,T)),[3,5];case 4:return a.sent(),l.default.error(1,n,"Config API failed"),[3,5];case 5:return v=(new Date).getTime(),d=_.default.parseOldSettings(d),S.default.set(u.default.PERSISTENT_STORAGE.WEB_SETTINGS,d),S.default.set(u.default.PERSISTENT_STORAGE.SETUP_TIME,v),i(m.sdkSettings=d),[3,7];case 6:return b=a.sent(),l.default.error(1,n,"Settings APi Failed: ",b),m.webSdkApiRetries<u.default.WEB_SDK_API_MAX_RETRIES?setTimeout((function(){m.webSdkApiRetries++,i(m.getAndPersistWebSettings(e))}),3e3*m.webSdkApiRetries):c(!1),[3,7];case 7:return[2]}}))}))}))},m.collectGetParams=function(){var e=this;return new Promise((function(t,n){h.default.get().then((function(n){var r=g.default.get();null!=r&&null!=r.appId||(r=new g.default(S.default.get(u.default.PERSISTENT_STORAGE.INIT_DATA)));var o=new Date,a=Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds());E.default.getInstance().then((function(o){var i={os:o.os,os_platform:o.osPlatform,is_incognito:o.isIncognito,app_id:r.appId,os_ver:o.name,sdk_ver:"2.5.5",model:o.name,app_ver:1,device_ts:Number(a),device_tz_offset:-6e4*(new Date).getTimezoneOffset(),unique_id:n.deviceUuid,device_tz:(new Date).getTimezoneOffset()},s=S.default.get(u.default.PERSISTENT_STORAGE.PUSH_TOKEN);null!=s&&"NA"!==s&&""!==s&&"null"!==s&&(i.push_id=s),o.isChromeLike()&&(f.isVapid(e.sdkSettings.platformSettings,o)?(i.subscription_type="vapid",i.vapid_public=f.getVapidPublicKey(e.sdkSettings.platformSettings,o)):i.subscription_type="normal",i.sender_id=e.sdkSettings.platformSettings.chrome.projectNumber),null!=r.environment&&(i.environment=r.environment),o.name===E.default.BROWSER_NAMES.SAFARI&&(i.websitePushId=e.sdkSettings.platformSettings.safari.websitePushId);var l=S.default.get(u.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS);if(null!=l&&null!=l.keys){for(var c in l.keys)i["keys_"+c]=encodeURI(l.keys[c]);null!=l.endpoint&&(i.endpoint=encodeURI(l.endpoint)),i.expirationTime=l.expirationTime}t(i)}))}))}))},m.getUpdatedPushDetails=function(){var e={},t=S.default.get(u.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS);if(null!=t){var n=S.default.get(u.default.PERSISTENT_STORAGE.PUSH_TOKEN);if(null!=n&&"NA"!==n&&""!==n&&"null"!==n&&(e.push_id=n),t.keys){for(var r in t.keys)e["keys_"+r]=encodeURI(t.keys[r]);null!=t.endpoint&&(e.endpoint=encodeURI(t.endpoint)),e.expirationTime=t.expirationTime}}return e},m.isPushSubAttributeAccepted=function(e){return e===u.default.ATTRIBUTE_NAMES.EMAIL},m.baseLogTag="MoeApi",m.onDeviceAdd=new f.PromiseObject,m.webSdkApiRetries=1,m.addReportApiRetries=1,m.eventStore=i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:u.default.EVENTS.DATABASE_NAME,storeName:u.default.EVENTS.STORE_NAME}),m);function m(){}t.default=T},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=(a.set=function(e,t){window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)},a.get=function(e){return r.getProp(window,"moeInternals.ephemeral."+e,null)},a.baseLogTag="EphemeralStorage",a);function a(){}t.default=o},function(e,t,n){var r=n(24),o=n(25),a=o;a.v1=r,a.v4=o,e.exports=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a,i,u=n(1),s=n(5),l=n(0),c=n(3),f=(d.getInstance=function(){return r(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return null!=s.default.get(u.default.EPHEMERAL_STORAGE.BROWSER_DETAILS)?[3,2]:[4,d.isIncognito(window)];case 1:return e=r.sent(),t=new d(navigator,document,e),s.default.set(u.default.EPHEMERAL_STORAGE.BROWSER_DETAILS,t),(n=c.default.get(u.default.PERSISTENT_STORAGE.BROWSER_DETAILS))&&d.isBrowserUpdated(n,t)||c.default.set(u.default.EPHEMERAL_STORAGE.BROWSER_DETAILS,t),[2,t];case 2:return[2,s.default.get(u.default.EPHEMERAL_STORAGE.BROWSER_DETAILS)]}}))}))},d.isIncognito=function(e){var t=e.RequestFileSystem||e.webkitRequestFileSystem;return new Promise((function(n){t?t(e.TEMPORARY,100,(function(){n(!1)}),(function(){n(!0)})):n(!1)}))},d.getBrowserName=function(e,t){return-1!==e.indexOf("MSIE")||1==t.documentMode?d.BROWSER_NAMES.INTERNET_EXPLORER:-1<e.indexOf("Edg")?d.BROWSER_NAMES.EDGE:-1<e.indexOf("OPR")||-1<e.indexOf("Opera")?d.BROWSER_NAMES.OPERA:-1<e.indexOf("Chrome")?-1<e.indexOf("MMS")?d.BROWSER_NAMES.OPERA_NEON:d.BROWSER_NAMES.CHROME:-1<e.indexOf("Safari")?d.BROWSER_NAMES.SAFARI:-1<e.indexOf("Firefox")?d.BROWSER_NAMES.FIREFOX:d.BROWSER_NAMES.OTHERS},d.isBrowserUpdated=function(e,t){return l.deepCompareObjects(e,t)},d.prototype.isChromeLike=function(){return this.isChrome()||this.isFirefox()||this.isOpera()},d.prototype.isChrome=function(){return this.name===d.BROWSER_NAMES.CHROME},d.prototype.isFirefox=function(){return this.name===d.BROWSER_NAMES.FIREFOX},d.prototype.isOpera=function(){return this.name===d.BROWSER_NAMES.OPERA||this.name===d.BROWSER_NAMES.OPERA_NEON},d.prototype.isSafari=function(){return this.name===d.BROWSER_NAMES.SAFARI},d);function d(e,t,n){this.os="web",this.osPlatform=e.userAgent,this.isMobile=l.isMobile(),this.os=l.isMobile()?"mweb":"web",this.name=d.getBrowserName(e.userAgent,t),this.isIncognito=n}(i=(a=f=f||{}).BROWSER_NAMES||(a.BROWSER_NAMES={})).CHROME="Google Chrome",i.FIREFOX="Mozilla Firefox",i.OPERA="Opera",i.OPERA_NEON="Opera Neon",i.SAFARI="Apple Safari",i.INTERNET_EXPLORER="Internet Explorer",i.EDGE="Edge",i.OTHERS="Others",t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),o=n(2),a=n(4),i=n(1),u=n(3),s=n(12),l=n(7),c=n(28),f=n(9),d=n(0),S=n(6),E=null,g=!1,p=null,_=(h.prototype.addAttribute=function(e){var t=this,n=h.baseLogTag+".addAttribute";return new Promise((function(r){e.key=h.getMorphedKey(e.key);for(var a=-1,i=t.attributes.length-1;0<=i;i--)e.key===t.attributes[i].key&&(a=i);o.default.log(2,n,"Adding attribute:",e),0<=a?(t.attributes[a].value,e.value,t.attributes[a].value=e.value):t.attributes.push(e),t.save().then((function(){r(!0)}))}))},h.getLocalUser=function(){var e=h.baseLogTag+".getLocalUser";return new Promise((function(t){u.default.get(i.default.PERSISTENT_STORAGE.USER_DATA)?(o.default.log(2,e,"Found user in localstorage"),t(new h(u.default.get(i.default.PERSISTENT_STORAGE.USER_DATA)))):t(null)}))},h.getCookieUser=function(){return new Promise((function(e){var t=h.baseLogTag+".getLocalUser";s.default.get(i.default.PERSISTENT_STORAGE.USER_DATA)?(o.default.log(2,t,"Found user in cookie"),e(new h(s.default.get(i.default.PERSISTENT_STORAGE.USER_DATA)))):e(null)}))},h.getSubdomainUser=function(){return new Promise((function(e){a.default.getWebSDKSettings().then((function(t){(E=new c.default(t)).getInSubdomain(i.default.PERSISTENT_STORAGE.USER_DATA).then((function(t){e(t?new h(t):null)}))}))}))},h.getMigrationUser=function(){var e=h.baseLogTag+".getLocalUser";return new Promise((function(t){var n=localStorage.getItem(i.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA);if(n)try{var a=JSON.parse(n);if(a.is_new_sdk_migrated)t(null);else{var u=new h({deviceAdded:d.getProp(a,"device_add",!1),deviceUuid:d.getProp(a,"uuid",S.v4())}),s=d.getProp(a,"user_attrs",{});for(var l in s)s.hasOwnProperty(l)&&u.attributes.push(new r.default(l,s[l]));var c=localStorage.getItem(i.default.PERSISTENT_STORAGE.OLD_SDK.PUSH_TOKEN);null!=c&&"NA"!==c&&"null"!==c&&(u.subscribedToOldSdk=!0),t(u)}}catch(n){o.default.error(1,e,"Error getting the migration user. Resolving as a new user."),o.default.error(1,e,n),t(null)}else t(null)}))},h.getSync=function(){return h.instance},h.get=function(){var e=h.baseLogTag+".get";return null!=p?p:p=new Promise((function(t){l.default.getInstance().then((function(n){a.default.getWebSDKSettings().then((function(r){g=r.isDomainLevelStorage;var a="https";n.isChromeLike()&&(r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.HTTP||r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.MUTLI&&"http"===d.getCurrentProtocol())&&(a="http");var u=h.getLocalUser(),s=r.isDomainLevelStorage?h.getCookieUser():"resolved",l="http"===a?h.getSubdomainUser():"resolved",c=h.getMigrationUser();Promise.all([u,s,l,c]).then((function(a){var u=a[0],s=a[1],l=a[2],c=a[3];c?c.save().then((function(n){var r=localStorage.getItem(i.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA);if(r){var a=JSON.parse(r);a.is_new_sdk_migrated=!0,localStorage.setItem(i.default.PERSISTENT_STORAGE.OLD_SDK.USER_DATA,JSON.stringify(a))}o.default.log(1,e,"User resolved from older SDK: ",n),t(n)})):n.isChromeLike()&&(r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.HTTP||r.platformSettings.chrome.domainType===f.ChromeConfig.DOMAIN_TYPE.MUTLI&&"http"===d.getCurrentProtocol())&&l&&"resolved"!==l?(o.default.log(1,e,"User resolved from subdomain: ",l),l.save().then((function(e){t(e)}))):s&&"resolved"!==s?(o.default.log(1,e,"User resolved from cookie: ",s),s.save().then((function(e){t(e)}))):(o.default.log(1,e,"Local user: ",u),new h(u).save().then((function(e){t(e)})))}))}))}))}))},h.logout=function(){var e=this;return new Promise((function(t){p=null,(e.instance=null)!=E?E.logout().then((function(){t()})):t()}))},h.prototype.save=function(){var e=this,t=h.baseLogTag+".save";return h.isAmpEnabled()&&(this.deviceUuid=s.default.get("moe_uuid")),h.instance=this,new Promise((function(n){u.default.set(i.default.PERSISTENT_STORAGE.USER_DATA,e),s.default.setRaw(i.default.AMP.UUID,h.instance.deviceUuid),g&&s.default.set(i.default.PERSISTENT_STORAGE.USER_DATA,e),null!=E?E.setInSubDomainStorage(i.default.PERSISTENT_STORAGE.USER_DATA,e).then((function(){n(e)})).catch((function(r){o.default.error(1,t,"Error storing value in subdomain"),n(e)})):n(e)}))},h.isAmpEnabled=function(){var e=s.default.get(i.default.AMP.UUID);return e&&e.includes("amp")},h.prototype.getAttribute=function(e){var t=null;return e=h.getMorphedKey(e),this.attributes.map((function(n){n.key===e&&(t=n.value)})),t},h.prototype.indexOfAttribute=function(e){var t=-1;return e=h.getMorphedKey(e),this.attributes.map((function(n,r){n.key===e&&(t=r)})),t},h.getMorphedKey=function(e){switch(e){case"id":e=i.default.ATTRIBUTE_NAMES.ID;break;case"email":e=i.default.ATTRIBUTE_NAMES.EMAIL;break;case"name":e=i.default.ATTRIBUTE_NAMES.NAME;break;case"first_name":e=i.default.ATTRIBUTE_NAMES.FIRST_NAME;break;case"last_name":e=i.default.ATTRIBUTE_NAMES.LAST_NAME;break;case"mobile":e=i.default.ATTRIBUTE_NAMES.MOBILE;break;case"gender":e=i.default.ATTRIBUTE_NAMES.GENDER;break;case"birthday":e=i.default.ATTRIBUTE_NAMES.BDAY}return e},h.baseLogTag="UserModel",h.isResolved=!1,h.instance=null,h);function h(e){this.attributes=[],this.subscribedToOldSdk=!1,null==e?(this.deviceUuid=S.v4(),this.attributes=[],this.deviceAdded=!1):(this.deviceUuid=d.getProp(e,"deviceUuid",S.v4()),this.attributes=d.getProp(e,"attributes",[]),this.deviceAdded=d.getProp(e,"deviceAdded",!1))}t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(2),a=n(1),i=(u.parseOldSettings=function(e){var t=u.baseLogTag+".parseOldSettings",n=new u;if((n.oldWebData=e).webData&&!r.isObjectEmpty(e.webData)){n.isConfigured=!0;var a=e.webData,i=r.getProp(a,"domain_type",null);i&&("http"===i.toLowerCase()?n.platformSettings.chrome.domainType=p.DOMAIN_TYPE.HTTP:"https"===i.toLowerCase()?n.platformSettings.chrome.domainType=p.DOMAIN_TYPE.HTTPS:"multi"===i.toLowerCase()?n.platformSettings.chrome.domainType=p.DOMAIN_TYPE.MUTLI:n.platformSettings.chrome.domainType=p.DOMAIN_TYPE.NA),n.platformSettings.chrome.subdomainURL=r.getProp(a,"subdomainUrl",null),"false"===r.getProp(a,"domain_level_storage",!1)?n.isDomainLevelStorage=!1:n.isDomainLevelStorage=!(!r.getProp(a,"domain_level_storage",!1)&&"true"!==r.getProp(a,"domain_level_storage",!1));var l=r.getProp(a,"PushSubBilling",!1);"false"===l?l=!1:"true"===l&&(l=!0),r.validateDataType.isBoolean(l)||(l=!1),n.isPushSubBilling=l,n.platformSettings.chrome.domainType!==p.DOMAIN_TYPE.HTTP&&n.platformSettings.chrome.domainType!==p.DOMAIN_TYPE.MUTLI||n.platformSettings.chrome.subdomainURL||o.default.warn(1,t,"No sub domain defined for HTTP site"),n.platformSettings.chrome.enabled=!0,n.platformSettings.chrome.apiKey=r.getProp(a,"webPushPlatformData.chrome.api_key",""),n.platformSettings.chrome.projectNumber=r.getProp(a,"webPushPlatformData.chrome.project_number",null),n.platformSettings.chrome.subscriptionMode=r.getProp(a,"webPushPlatformData.chrome.subscriptionMode","normal"),n.platformSettings.chrome.vapidPublicKey=r.getProp(a,"webPushPlatformData.chrome.vapidPublicKey",null),n.platformSettings.firefox.enabled=!0,n.platformSettings.firefox.apiKey=r.getProp(a,"webPushPlatformData.chrome.api_key",""),n.platformSettings.firefox.projectNumber=r.getProp(a,"webPushPlatformData.chrome.project_number",null),n.platformSettings.firefox.subscriptionMode=r.getProp(a,"webPushPlatformData.firefox.subscriptionMode","normal"),n.platformSettings.firefox.vapidPublicKey=r.getProp(a,"webPushPlatformData.firefox.vapidPublicKey",null),n.platformSettings.safari.websitePushId=r.getProp(a,"webPushPlatformData.safari.websitePushId",null),null==n.platformSettings.safari.websitePushId?n.platformSettings.safari.enabled=!1:n.platformSettings.safari.enabled=!0,r.getProp(a,"call_push_moengage",!0)?r.getProp(a,"banner.banner_flag",null)?n.optInConfig.type=s.TYPE.TWO_STEP:n.optInConfig.type=s.TYPE.ONE_CLICK:n.optInConfig.type=s.TYPE.SELF_HANDLED,n.optInConfig.reappearTime=parseInt(r.getProp(a,"promptAgain",24)),n.optInConfig.showOverlay=r.getProp(a,"show_overlay",!1),n.optInConfig.loadTime=r.getProp(a,"load_time",0),n.optInConfig.softAskConfig.desktop.customHTML=r.getProp(a,"bannerHtml.web",null),n.optInConfig.softAskConfig.mobile.customHTML=r.getProp(a,"bannerHtml.mweb",null),n.platformSettings.chrome.isServiceWorkerRoot=!r.getProp(a,"is_service_worker_not_root",!1),n.platformSettings.chrome.serviceWorkerFilename=r.getProp(a,"serviceworker_file","serviceworker.js"),""===n.platformSettings.chrome.serviceWorkerFilename&&(n.platformSettings.chrome.serviceWorkerFilename="serviceworker.js"),n.inappEnabled=r.getProp(a,"inappEnabled",!1),n.featureAvailabilityMatrix=new g,n.featureAvailabilityMatrix=r.getProp(a,"featureAvailabilityMatrix",null),n.s_i_d=r.getProp(a,"s_i_d",1800),n.s_s_s=r.getProp(a,"s_s_s","allowed"),n.src_ext=r.getProp(a,"src_ext",[])}else n.isConfigured=!1;return n},u.isFeatureEnabled=function(e,t){if(t!==a.default.SDK_FEATURES.WEB_PUSH)return!0;var n=r.getProp(e,"featureAvailabilityMatrix.webPush",null);if(n){var o=n.domains;return!(0<=o.values.indexOf(window.location.hostname)!=("whitelist"===o.type))}return!0},u.baseLogTag="SdkSettings",u);function u(){this.isDomainLevelStorage=!1,this.isConfigured=!1,this.isPushSubBilling=!1,this.platformSettings=new _,this.optInConfig=new s,this.s_i_d=1800}var s=function e(){this.type=e.TYPE.NA,this.reappearTime=24,this.softAskConfig={desktop:new f,mobile:new f}};t.OptInConfig=s;var l,c,f=function(){this.customHTML=null};(c=(l=s=s||{}).TYPE||(l.TYPE={})).NA="NA",c.ONE_CLICK="ONE_CLICK",c.TWO_STEP="TWO_STEP",c.SELF_HANDLED="SELF_HANDLED",t.OptInConfig=s;var d=function(){this.enabled=!1,this.websitePushId=null};t.SafariConfig=d;var S,E,g=function(){this.webPush=null},p=function e(){this.enabled=!1,this.domainType=e.DOMAIN_TYPE.NA,this.isServiceWorkerRoot=!0,this.serviceWorkerFilename="serviceworker.js",this.apiKey="",this.subscriptionMode="normal",this.vapidPublicKey=null};t.ChromeConfig=p,(E=(S=p=p||{}).DOMAIN_TYPE||(S.DOMAIN_TYPE={})).NA="NA",E.HTTP="http",E.HTTPS="https",E.MUTLI="multi",t.ChromeConfig=p;var _=function(){this.safari=new d,this.chrome=new p,this.firefox=new p};t.PushPlatformSettings=_,t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,a=n(1),i=n(0),u=n(5),s=n(2),l=n(3),c=(f.save=function(e){u.default.set(a.default.EPHEMERAL_STORAGE.INIT_DATA,new f(e)),l.default.set(a.default.PERSISTENT_STORAGE.INIT_DATA,new f(e))},f.get=function(){return u.default.get(a.default.EPHEMERAL_STORAGE.INIT_DATA)},f.setSoftAskConfig=function(e){var t=f.get(),n={appId:t.appId,debugLevel:t.debugLevel,cluster:t.cluster,environment:t.environment,swPath:t.swPath,customSoftAsk:{mainClass:i.getProp(e,"main_class",i.getProp(e,"mainClass",null)),allowClass:i.getProp(e,"allow_class",i.getProp(e,"allowClass",null)),dismissClass:i.getProp(e,"block_class",i.getProp(e,"dismissClass",null))}};f.save(n)},f.baseLogTag="InitData",f);function f(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://websdk.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=f.baseLogTag+".constructor";null!=i.getProp(e,"app_id",null)?(this.appId=i.getProp(e,"app_id",null),this.integrationType=r.OLD_SDK):null!=i.getProp(e,"appId",null)?(this.appId=i.getProp(e,"appId",null),this.integrationType=r.NEW_SDK):(s.default.error(1,t,"App Id not specified. Please check docs page to complete the integration - ",a.default.LINKS.WEBSDK_DOCS),this.integrationType=null),null!=i.getProp(e,"debug_logs",null)?this.debugLevel=i.getProp(e,"debug_logs",0):null!=i.getProp(e,"debugLevel",null)?this.debugLevel=i.getProp(e,"debugLevel",0):(s.default.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://websdk.moengage.com/",this.forceSwUpdate=i.getProp(e,"forceSwUpdate",!1),this.cluster=i.getProp(e,"cluster",null),this.cluster&&null!=a.default.CLUSTER_ENVIRONMENT_MAP[this.cluster]&&(this.environment=a.default.CLUSTER_ENVIRONMENT_MAP[this.cluster]),i.getProp(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+".moengage.com/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=i.getProp(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:i.getProp(e,"customSoftAsk.mainClass",null),allowClass:i.getProp(e,"customSoftAsk.allowClass",null),dismissClass:i.getProp(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:i.getProp(e,"main_class",null),allowClass:i.getProp(e,"allow_class",null),dismissClass:i.getProp(e,"block_class",null)},null!=i.getProp(e,"inapp.host",null)&&(this.inapp={host:i.getProp(e,"inapp.host",null)}),null!=i.getProp(e,"swScope",null)&&(this.swScope=i.getProp(e,"swScope",null)),null!=i.getProp(e,"disable_onsite",null)&&(this.disableOnsite=i.getProp(e,"disable_onsite",!1)))}t.default=c,(o=r=r||{}).OLD_SDK="OLD_SDK",o.NEW_SDK="NEW_SDK"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.equal=function(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)},o);function o(e,t){this.key=e,this.value=t}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(1),a=n(0),i=(u.set=function(e,t){var n=u.baseTag+".set";if(null==t)u.remove(e);else{t="boolean"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"boolean"}):"string"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"string"}):JSON.stringify(t),r.default.log(3,n,"Setting ",e,":",t);var a=Date.now(),i=";expires="+new Date(a+31536e6*o.default.COOKIE_STORAGE.SESSION_COOKIE.EXPIRY_YEARS).toUTCString();document.cookie=e+"="+encodeURIComponent(t)+i+";domain="+u.getOrigin()+";path=/;SameSite=None; Secure"}},u.get=function(e){for(var t=u.baseTag+".get",n=e+"=",o=decodeURIComponent(document.cookie).split(";"),i=o.length-1;0<=i;i--){for(var s=o[i];" "===s.charAt(0);)s=s.substring(1);if(0===s.indexOf(n)){var l=s.substring(n.length,s.length);try{l=JSON.parse(l),"string"===a.getProp(l,"MOE_DATA_TYPE",null)?l=(l=a.getProp(l,"actualValue",null))?String(l):null:"boolean"===a.getProp(l,"MOE_DATA_TYPE",null)&&(l=a.getProp(l,"actualValue",null))}catch(e){}return r.default.log(3,t,"Got ",e,":",l),l}}return null},u.remove=function(e){var t=u.baseTag+".remove";document.cookie=e+"=;domain="+u.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",r.default.log(3,t,"Removed ",e)},u.setRaw=function(e,t,n){var o=u.baseTag+".setRaw";if(null==t)u.remove(e);else{r.default.log(3,o,"Setting ",e,":",t);var a="";null!=n&&(a=";expires="+n.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+a+";domain="+u.getOrigin()+";path=/;"}},u.getOrigin=function(){var e=u.baseTag+".getOrigin",t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(r.default.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t},u.baseTag="CookieStorage",u);function u(){}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(3),a=(i.enqueue=function(e,t){var n=i.getLocalStorageQName(e),r=new i;o.default.get(n)&&(r=o.default.get(n)),r.items.push(t),r.items=r.items.slice(Math.max(r.items.length-50,0)),o.default.set(n,r)},i.dequeue=function(e){var t=i.getLocalStorageQName(e),n=o.default.get(t),r=null;return n&&0<n.items.length&&(r=n.items[0],n.items.splice(0,1),o.default.set(t,n)),r},i.isEmpty=function(e){var t=i.getLocalStorageQName(e);return!(o.default.get(t)&&0<o.default.get(t).items.length)},i.purge=function(e){var t=i.getLocalStorageQName(e);i.isEmpty(e)||o.default.remove(t)},i.getLocalStorageQName=function(e){return r.default.PERSISTENT_STORAGE.Q.PREFIX+"_"+e},i);function i(){this.items=[]}t.default=a},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.PERMISSION_STATE||(t.PERMISSION_STATE={})).PROMPT="prompt",r.GRANTED="granted",r.DENIED="denied",r.DISMISSED="dismissed"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,a=n(0),i=(u.get=function(e,t){return u.makeNetworkCall(u.METHODS.GET,e,t)},u.post=function(e,t){return u.makeNetworkCall(u.METHODS.POST,e,t)},u.makeNetworkCall=function(e,t,n){return void 0===n&&(n={}),new Promise((function(r,o){var i=JSON.stringify(a.getProp(n,"postData",null));t=u.constructFinalUrl(t,a.getProp(n,"queryParams",null));var s=new XMLHttpRequest;s.open(e,t,!0),u.addRequestHeaders(s,a.getProp(n,"headers",{})),s.onreadystatechange=function(){4===s.readyState&&200===s.status?r({status:s.status,responseText:s.responseText}):4===s.readyState&&200!==s.status&&o({code:s.status,reason:s.responseText})},s.send(i)}))},u.addRequestHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e},u.constructFinalUrl=function(e,t){for(var n in e+="?",t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return e},u);function u(){}(o=(r=i=i||{}).METHODS||(r.METHODS={})).GET="GET",o.POST="POST",t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(6),a=(i.prototype.sendMessage=function(e,t){var n=this;return new Promise((function(r,a){var i={id:o.v4(),channel:n.channel,topic:e,message:t};n.addToListener(i,r,a),n.target instanceof HTMLIFrameElement?n.target.contentWindow.postMessage(i,n.target.src):n.target.postMessage(i,"*")}))},i.listenToChannel=function(e,t,n){window.addEventListener("message",(function(r){r.data&&r.data.channel&&r.data.topic&&r.data.channel===e&&r.data.topic===t&&n(r.data,(function(n){var o={id:r.data.id,channel:e,topic:t,message:n};r.source.postMessage(o,r.origin)}))}))},i.prototype.addToListener=function(e,t,n){var o=this;i.pendingPromises[e.id]={resolve:t,reject:n},window.addEventListener("message",(function(e){e.data&&r.getProp(e.data,"channel",null)===o.channel&&null!=i.pendingPromises[e.data.id]&&(i.pendingPromises[e.data.id].resolve(e.data),delete i.pendingPromises[e.data.id])}))},i.pendingPromises={},i);function i(e,t){this.channel=e,this.target=t}t.default=a},function(e,t,n){(function(t){e.exports=function e(t,n,r){function o(i,u){if(!n[i]){if(!t[i]){if(a)return a(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){return o(t[i][1][e]||e)}),l,l.exports,e,t,n,r)}return n[i].exports}for(var a=!1,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,n,r){(function(e){"use strict";var t,r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var a=0,i=new o(c),u=e.document.createTextNode("");i.observe(u,{characterData:!0}),t=function(){u.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)};else{var s=new e.MessageChannel;s.port1.onmessage=c,t=function(){s.port2.postMessage(0)}}var l=[];function c(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}n.exports=function(e){1!==l.push(e)||r||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function o(){}var a={},i=["REJECTED"],u=["FULFILLED"],s=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,e!==o&&S(this,e)}function c(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function f(e,t,n){r((function(){var r;try{r=t(n)}catch(r){return a.reject(e,r)}r===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,r)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function S(e,t){var n=!1;function r(t){n||(n=!0,a.reject(e,t))}function o(t){n||(n=!0,a.resolve(e,t))}var i=E((function(){t(o,r)}));"error"===i.status&&r(i.value)}function E(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=l).prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===u||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(o);this.state!==s?f(n,this.state===u?e:t,this.outcome):this.queue.push(new c(n,e,t));return n},c.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){a.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},a.resolve=function(e,t){var n=E(d,t);if("error"===n.status)return a.reject(e,n.value);var r=n.value;if(r)S(e,r);else{e.state=u,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},a.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:a.resolve(new this(o),e)},l.reject=function(e){var t=new this(o);return a.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),u=0,s=-1,l=new this(o);++s<n;)c(e[s],s);return l;function c(e,o){t.resolve(e).then((function(e){i[o]=e,++u!==n||r||(r=!0,a.resolve(l,i))}),(function(e){r||(r=!0,a.reject(l,e))}))}},l.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var r,i=-1,u=new this(o);++i<t;)r=e[i],this.resolve(r).then((function(e){n||(n=!0,a.resolve(u,e))}),(function(e){n||(n=!0,a.reject(u,e))}));return u}},{1:1}],3:[function(e,n,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function a(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var i=Promise;function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function s(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function c(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var f="local-forage-detect-blob-support",d=void 0,S={},E=Object.prototype.toString,g="readonly",p="readwrite";function _(e){return"boolean"==typeof d?i.resolve(d):function(e){return new i((function(t){var n=e.transaction(f,p),r=a([""]);n.objectStore(f).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||43<=parseInt(e[1],10))}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function h(e){var t=S[e.name],n={};n.promise=new i((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function T(e){var t=S[e.name].deferredOperations.pop();return t&&(t.resolve(),t.promise)}function m(e,t){var n=S[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function v(e,t){return new i((function(n,r){if(S[e.name]=S[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);h(e),e.db.close()}var a=[e.name];t&&a.push(e.version);var i=o.open.apply(o,a);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(f)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){n(i.result),T(e)}}))}function b(e){return v(e,!1)}function A(e){return v(e,!0)}function I(e,t){if(!e.db)return 1;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return 1}}function O(e){return a([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}(atob(e.data))],{type:e.type})}function y(e){return e&&e.__local_forage_encoded_blob}function P(e){var t=this,n=t._initReady().then((function(){var e=S[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return s(n,e,e),n}function R(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(0<r&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return i.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),A(e)})).then((function(){return function(e){h(e);for(var t=S[e.name],n=t.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,b(e).then((function(t){return e.db=t,I(e)?A(e):t})).then((function(r){e.db=t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(t){throw m(e,t),t}))}(e).then((function(){R(e,t,n,r-1)}))})).catch(n);n(o)}}var N={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var o=S[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},S[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=P);var a=[];function u(){return i.resolve()}for(var s=0;s<o.forages.length;s++){var l=o.forages[s];l!==t&&a.push(l._initReady().catch(u))}var c=o.forages.slice(0);return i.all(a).then((function(){return n.db=o.db,b(n)})).then((function(e){return n.db=e,I(n,t._defaultConfig.version)?A(n):e})).then((function(e){n.db=o.db=e,t._dbInfo=n;for(var r=0;r<c.length;r++){var a=c[r];a!==t&&(a._dbInfo.db=n.db,a._dbInfo.version=n.version)}}))},_support:function(){try{if(!o)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){R(n._dbInfo,g,(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).openCursor(),u=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;y(r)&&(r=O(r));var o=e(r,n.key,u++);void 0!==o?t(o):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(o){r(o)}}))})).catch(r)}));return u(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){R(n._dbInfo,g,(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),y(e)&&(e=O(e)),t(e)},i.onerror=function(){r(i.error)}}catch(o){r(o)}}))})).catch(r)}));return u(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var o=new i((function(n,o){var a;r.ready().then((function(){return a=r._dbInfo,"[object Blob]"===E.call(t)?_(a.db).then((function(e){return e?t:(n=t,new i((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){R(r._dbInfo,p,(function(a,i){if(a)return o(a);try{var u=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var s=u.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(a){o(a)}}))})).catch(o)}));return u(o,n),o},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){R(n._dbInfo,p,(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){r(i.error)},a.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(o){r(o)}}))})).catch(r)}));return u(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){R(t._dbInfo,p,(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(r){n(r)}}))})).catch(n)}));return u(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){R(t._dbInfo,g,(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).count();a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}}catch(r){n(r)}}))})).catch(n)}));return u(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){e<0?t(null):n.ready().then((function(){R(n._dbInfo,g,(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName),u=!1,s=i.openCursor();s.onsuccess=function(){var n=s.result;n?0===e||u?t(n.key):(u=!0,n.advance(e)):t(null)},s.onerror=function(){r(s.error)}}catch(o){r(o)}}))})).catch(r)}));return u(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){R(t._dbInfo,g,(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).openCursor(),i=[];a.onsuccess=function(){var t=a.result;t?(i.push(t.key),t.continue()):e(i)},a.onerror=function(){n(a.error)}}catch(r){n(r)}}))})).catch(n)}));return u(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n,r=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),e.name){var a=e.name===r.name&&this._dbInfo.db?i.resolve(this._dbInfo.db):b(e).then((function(t){var n=S[e.name],r=n.forages;n.db=t;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=t;return t}));n=e.storeName?a.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;h(e);var r=S[e.name],a=r.forages;t.close();for(var u=0;u<a.length;u++){var s=a[u];s._dbInfo.db=null,s._dbInfo.version=n}return new i((function(t,r){var a=o.open(e.name,n);a.onerror=function(e){a.result.close(),r(e)},a.onupgradeneeded=function(){a.result.deleteObjectStore(e.storeName)},a.onsuccess=function(){var e=a.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<a.length;t++){var n=a[t];n._dbInfo.db=e,T(n._dbInfo)}})).catch((function(t){throw(m(e,t)||i.resolve()).catch((function(){})),t}))}})):a.then((function(t){h(e);var n=S[e.name],r=n.forages;t.close();for(var a=0;a<r.length;a++)r[a]._dbInfo.db=null;return new i((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)T(r[t]._dbInfo)})).catch((function(t){throw(m(e,t)||i.resolve()).catch((function(){})),t}))}))}else n=i.reject("Invalid arguments");return u(n,t),n}},w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=/^~~local_forage_type~([^~]+)~/,M="__lfsc__:",C=M.length,k="arbf",L="blob",U=C+k.length,B=Object.prototype.toString;function W(e){var t,n,r,o,a,i=.75*e.length,u=e.length,s=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),c=new Uint8Array(l);for(t=0;t<u;t+=4)n=w.indexOf(e[t]),r=w.indexOf(e[t+1]),o=w.indexOf(e[t+2]),a=w.indexOf(e[t+3]),c[s++]=n<<2|r>>4,c[s++]=(15&r)<<4|o>>2,c[s++]=(3&o)<<6|63&a;return l}function H(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=w[n[t]>>2],r+=w[(3&n[t])<<4|n[t+1]>>4],r+=w[(15&n[t+1])<<2|n[t+2]>>6],r+=w[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var G={serialize:function(e,t){var n="";if(e&&(n=B.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===B.call(e.buffer))){var r,o=M;e instanceof ArrayBuffer?(r=e,o+=k):(r=e.buffer,"[object Int8Array]"===n?o+="si08":"[object Uint8Array]"===n?o+="ui08":"[object Uint8ClampedArray]"===n?o+="uic8":"[object Int16Array]"===n?o+="si16":"[object Uint16Array]"===n?o+="ur16":"[object Int32Array]"===n?o+="si32":"[object Uint32Array]"===n?o+="ui32":"[object Float32Array]"===n?o+="fl32":"[object Float64Array]"===n?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+H(r))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n="~~local_forage_type~"+e.type+"~"+H(this.result);t(M+L+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,C)!==M)return JSON.parse(e);var t,n=e.substring(U),r=e.substring(C,U);if(r===L&&D.test(n)){var o=n.match(D);t=o[1],n=n.substring(o[0].length)}var i=W(n);switch(r){case k:return i;case L:return a([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:W,bufferToString:H};function x(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function F(e,t,n,r,o,a){e.executeSql(n,r,o,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,u){u.rows.length?a(e,i):x(e,t,(function(){e.executeSql(n,r,o,a)}),a)}),a):a(e,i)}),a)}function K(e,t,n,r){var o=this;e=l(e);var a=new i((function(a,i){o.ready().then((function(){void 0===t&&(t=null);var u=t,s=o._dbInfo;s.serializer.serialize(t,(function(t,l){l?i(l):s.db.transaction((function(n){F(n,s,"INSERT OR REPLACE INTO "+s.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){a(u)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(0<r)return void a(K.apply(o,[e,u,n,r-1]));i(t)}}))}))})).catch(i)}));return u(a,n),a}var j={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var o=new i((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(o){x(o,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=G,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){F(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var a=r.rows,i=a.length,u=0;u<i;u++){var s=a.item(u),l=s.value;if(l=l&&o.serializer.deserialize(l),void 0!==(l=e(l,s.key,u+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){F(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r=r&&o.serializer.deserialize(r),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r},setItem:function(e,t,n){return K.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){F(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){F(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){F(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;return u(r=e.name?new i((function(t){var r,a;r=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t((a=r,new i((function(e,t){a.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).name);e({db:a,storeNames:r})}),(function(e,n){t(n)}))}),(function(e){t(e)}))}))))})).then((function(e){return new i((function(t,n){e.db.transaction((function(r){function o(e){return new i((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var a=[],u=0,s=e.storeNames.length;u<s;u++)a.push(o(e.storeNames[u]));i.all(a).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):i.reject("Invalid arguments"),t),r}};function V(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}var Y={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=V(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),void localStorage.removeItem(e)}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=G,i.resolve()):i.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,o=r.length,a=localStorage.length,i=1,u=0;u<a;u++){var s=localStorage.key(u);if(0===s.indexOf(r)){var l=localStorage.getItem(s);if(l=l&&t.serializer.deserialize(l),void 0!==(l=e(l,s.substring(o),i++)))return l}}}));return u(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&t.serializer.deserialize(r)}));return u(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var o=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new i((function(o,a){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)a(r);else try{localStorage.setItem(i.keyPrefix+e,t),o(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||a(t),a(t)}}))}))}));return u(o,n),o},removeItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;0<=n;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return u(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(r){t=null}return t&&t.substring(r.keyPrefix.length)}));return u(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var a=localStorage.key(o);0===a.indexOf(e.keyPrefix)&&r.push(a.substring(e.keyPrefix.length))}return r}));return u(n,e),n},dropInstance:function(e,t){if(t=c.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,o=this;return u(r=e.name?new i((function(t){e.storeName?t(V(e,o._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):i.reject("Invalid arguments"),t),r}},q=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},z=function(e,t){for(var n=e.length,r=0;r<n;){if(q(e[r],t))return!0;r++}return!1},Q=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},X={},J={},Z={INDEXEDDB:N,WEBSQL:j,LOCALSTORAGE:Y},$=[Z.INDEXEDDB._driver,Z.WEBSQL._driver,Z.LOCALSTORAGE._driver],ee=["dropInstance"],te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),ne={description:"",driver:$.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function re(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function oe(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Q(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ae=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z)if(Z.hasOwnProperty(n)){var r=Z[n],o=r._driver;this[n]=o,X[o]||this.defineDriver(r)}this._defaultConfig=oe({},ne),this._config=oe({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"!==(void 0===e?"undefined":r(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},e.prototype.defineDriver=function(e,t,n){var r=new i((function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var a=te.concat("_initStorage"),s=0,l=a.length;s<l;s++){var c=a[s];if((!z(ee,c)||e[c])&&"function"!=typeof e[c])return void n(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=i.reject(t);return u(n,arguments[arguments.length-1]),n}},n=0,r=ee.length;n<r;n++){var o=ee[n];e[o]||(e[o]=t(o))}}();var f=function(n){X[r]&&console.info("Redefining LocalForage driver: "+r),X[r]=e,J[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(f,n):f(!!e._support):f(!0)}catch(o){n(o)}}));return s(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=X[e]?i.resolve(X[e]):i.reject(new Error("Driver not found."));return s(r,t,n),r},e.prototype.getSerializer=function(e){var t=i.resolve(G);return s(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return s(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Q(e)||(e=[e]);var o=this._getSupportedDrivers(e);function a(){r._config.driver=r.driver()}function u(e){return r._extend(e),a(),r._ready=r._initStorage(r._config),r._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return i.resolve()})):i.resolve();return this._driverSet=l.then((function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,a(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(u).catch(n)}a();var s=new Error("No available storage method found.");return r._driverSet=i.reject(s),r._driverSet}()}}(o)}))})).catch((function(){a();var e=new Error("No available storage method found.");return r._driverSet=i.reject(e),r._driverSet})),s(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!J[e]},e.prototype._extend=function(e){oe(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=te.length;e<t;e++)re(this,te[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ae},{3:3}]},{},[4])(4)}).call(this,n(30))},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(6),i=n(8),u=n(0),s=(l.baseLogTag="ReportPostData",l);function l(){var e=l.baseLogTag+".constructor",t=i.default.getSync().getAttribute("id");t=t?t.toString():void 0;var n=window.analytics,r=void 0,u=void 0;if(n){u=n._VERSIONS;try{r=n.user().anonymousId()}catch(t){o.default.error(1,e,"Error getting anonymous id from segment api",t)}}this.c=void 0,this.h="",this.identifiers=void 0,(t||r)&&(this.identifiers={moe_user_id:t,segment_id:r}),this.meta={bid:a.v4(),segmentSdkData:n?u:void 0}}var c,f,d,S=(E.baseLogTag="ReportClass",E);function E(e,t,n){var o,a;this.type=e,this.getParams=t,this.event=n,this.postData=new s;var i={},l={};try{for(var c=r(n.attributes),f=c.next();!f.done;f=c.next()){var d=f.value;if(d&&null!=d.key&&(this.status=E.STATUS.VALID,null!=d.value))if("function"==typeof d.value.getMonth){var S={};S[d.key]=Math.round(d.value.getTime()-6e4*d.value.getTimezoneOffset()),null==l.timestamp&&(l.timestamp=[]),l.timestamp.push(S)}else i[d.key]=d.value}}catch(e){o={error:e}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}this.postData.e=n.name,this.postData.a=i,this.postData.c=u.isObjectEmpty(l)?void 0:l,window&&window.location&&null!=window.location.href&&(this.postData.url=window.location.href)}(f=(c=S=S||{}).STATUS||(c.STATUS={}))[f.INVALID=0]="INVALID",f[f.VALID=1]="VALID",(d=c.REPORT_ADD_TYPE||(c.REPORT_ADD_TYPE={}))[d.USER_ATTRIBUTE=0]="USER_ATTRIBUTE",d[d.EVENT=1]="EVENT",t.default=S},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),i=n(1),u=n(4),s=n(11),l=n(22),c=n(20),f=n(33),d=n(23),S=(E.track=function(e,t,n){var S=this,E="MoEngage.event.trackEvent";return new Promise((function(g,p){return r(S,void 0,void 0,(function(){var S,p,_,h,T=this;return o(this,(function(m){switch(m.label){case 0:return n=!!n,"string"==typeof e&&e?[3,1]:(a.default.log(1,E,"Event name not a string or null or empty string:",e),g({error:5001,message:"Event name can not be null"}),[3,6]);case 1:if(m.trys.push([1,5,,6]),S=[],null!=t&&(null===t||t!==Object(t)||"[object Object]"!==Object.prototype.toString.call(t)))return[3,3];for(p in null==t&&(t={}),t)t.hasOwnProperty(p)&&S.push(new s.default(p,t[p]));return[4,l.default.createEvent(e,S)];case 2:return _=m.sent(),f.default.addEvent(_),u.default.collectGetParams().then((function(e){var t=new c.default(c.default.REPORT_ADD_TYPE.EVENT,e,_),a=new d.default;u.default.getWebSDKSettings().then((function(e){return r(T,void 0,void 0,(function(){var r,s,l;return o(this,(function(o){return a.isNonEventInteractive(_)||(r={session_id:a.getSessionKey(),start_time:a.getSessionStartTime(),background_initiated:0},s=[],l=a.getCurrentSource(),a.setCurrentSource(l),l&&s.push(l),t.postData.meta.session=r,s.length&&(t.postData.meta.source=s)),u.default.reportAdd(t,n).then((function(){e.s_s_s!==i.SESSION_SOURCE_STATUS.ALLOWED||a.isNonEventInteractive(_)||a.extendSession(),g()})),[2]}))}))}))})),[3,4];case 3:a.default.error(1,E,"Event attributes were not passed a key-value pair object for event: ",e),g({error:5002,message:"Event value needs to be a key-value pair object"}),m.label=4;case 4:return[3,6];case 5:return h=m.sent(),a.default.error(1,E,"Error occurred in tracking events ",h),[3,6];case 6:return[2]}}))}))}))},E);function E(){}t.default=S},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),i=n(1),u=n(8),s=n(2),l=n(23),c=(f.createUserAttributeEvent=function(e){return new Promise((function(t,n){var r=[],o=e.key;switch(e.key){case"id":e.key=i.default.ATTRIBUTE_NAMES.ID;break;case"email":e.key=i.default.ATTRIBUTE_NAMES.EMAIL;break;case"name":e.key=i.default.ATTRIBUTE_NAMES.NAME;break;case"first_name":e.key=i.default.ATTRIBUTE_NAMES.FIRST_NAME;break;case"last_name":e.key=i.default.ATTRIBUTE_NAMES.LAST_NAME;break;case"mobile":e.key=i.default.ATTRIBUTE_NAMES.MOBILE;break;case"gender":e.key=i.default.ATTRIBUTE_NAMES.GENDER;break;case"birthday":e.key=i.default.ATTRIBUTE_NAMES.BDAY}r.push(e),u.default.get().then((function(n){var u=n.indexOfAttribute("oldUniqueIds");-1<u&&null!=n.attributes[u].value&&0<n.attributes[u].value.length&&r.push(new a.default(i.default.ATTRIBUTE_NAMES.ID_MODIFIED,n.attributes[u].value[n.attributes[u].value.length-1])),e.key!==o&&s.default.log(2,"Event.createUserAttributeEvent","Key changed to MoE reserved keyname: ",e.key),t(new f(i.default.EVENT_NAMES.USER_ATTRIBUTE,r,!1))}))}))},f.createEvent=function(e,t,n){var c=this;return new Promise((function(d,S){u.default.get().then((function(u){return r(c,void 0,void 0,(function(){var r,c,S,E;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),r=new a.default(i.default.EVENT_ATTRIBUTES_NAMES.LOGGED_IN_STATUS,!!u.getAttribute("id")),[4,(c=new l.default).initiateSessionAndSource()];case 1:return o.sent(),S=new a.default(i.default.EVENT_ATTRIBUTES_NAMES.FIRST_VISIT,c.getNumberOfSessions()<=i.PAGE_LIFE_CYCLE.FIRST_SEEN_SESSIONS),t.push(r,S),d(new f(e,t,n)),[3,3];case 2:return E=o.sent(),s.default.error(1,"Event.createEvent","Error occurred in create events ",E),[3,3];case 3:return[2]}}))}))}))}))},f);function f(e,t,n){void 0===n&&(n=!0),this.name=e,this.attributes=t,n&&this.attributes.push(new a.default(i.default.EVENT_ATTRIBUTES_NAMES.URL,location.href))}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(3),a=n(1),i=n(0),u=n(4),s=n(0),l=n(5),c=(f.prototype.initiateSessionAndSource=function(){var e=this;return new Promise((function(t,n){setTimeout((function(){e.isSessionRunning()&&e.isCurrentSourceSameAsPreviousSource()||e.startNewSession(),t()}),250)}))},f.prototype.isSessionRunning=function(){return this.getSessionKey()&&!this.isSessionExpired()},f.prototype.isSessionExpired=function(){var e=this.getSessionExpiryTime(),t=l.default.get("wasBrowserInactive");return!(!t&&null!==t)&&(this.isWindowActive()&&l.default.set("wasBrowserInactive",!1),(new Date).getTime()>e)},f.prototype.isNonEventInteractive=function(e){return f.NON_INTERACTIVE_EVENTS.includes(e.name)||0<e.attributes.filter((function(e){return"moe_non_interactive"===e.key&&1===e.value})).length},f.prototype.getCurrentSource=function(){var e=i.deserializeQueryParams(window.location.search);if(!this.isSourceOrganic()){var t="",n={};return Object.keys(e).includes("utm_source")&&(t="utm_"),this.geCustomIdentifiersToTrack().forEach((function(t){e[t]&&(n[t]=e[t])})),{source:e[t+"source"],medium:e[t+"medium"],source_url:window.location.href,term:e[t+"term"],campaign_name:e[t+"campaign"],campaign_id:e.utm_id,campaign_type:e[t+"content"],extra:Object.keys(n).length?n:void 0}}},f.prototype.isSourceOrganic=function(){var e=i.deserializeQueryParams(window.location.search),t=Object.keys(e),n=!1;return this.geCustomIdentifiersToTrack().forEach((function(t){e[t]&&(n=!0)})),!t.includes("utm_source")&&!t.includes("source")&&!n},f.prototype.setCurrentSource=function(e){var t=this.getSession();t.currentSource=e,o.default.set(a.default.SESSION_SOURCE.SESSION,t)},f.prototype.getSavedSource=function(){var e=s.getProp(this.getSession(),a.default.SESSION_SOURCE.CURRENT_SOURCE,void 0);if(e)return e},f.prototype.isCurrentSourceSameAsPreviousSource=function(){return!!this.isSourceOrganic()||i.deepCompareObjects(this.getCurrentSource(),this.getSavedSource())},f.prototype.getSessionKey=function(){return s.getProp(this.getSession(),a.default.SESSION_SOURCE.SESSION_KEY,null)},f.prototype.getSessionStartTime=function(){return s.getProp(this.getSession(),a.default.SESSION_SOURCE.SESSION_START_TIME,null)},f.prototype.getSessionExpiryTime=function(){return s.getProp(this.getSession(),a.default.SESSION_SOURCE.SESSION_EXPIRY_TIME,null)},f.prototype.getSessionMaxTime=function(){return s.getProp(this.getSession(),a.default.SESSION_SOURCE.SESSION_MAX_TIME,null)},f.prototype.getSession=function(){return o.default.get(a.default.SESSION_SOURCE.SESSION)},f.prototype.geCustomIdentifiersToTrack=function(){return s.getProp(this.getSession(),a.default.SESSION_SOURCE.CUSTOM_IDENTIFIERS_TO_TRACK,[])},f.prototype.generateSessionKey=function(){return r.v4()},f.prototype.startNewSession=function(){var e=this;u.default.getWebSDKSettings().then((function(t){var n=e.getNumberOfSessions(),r={sessionKey:e.generateSessionKey(),sessionStartTime:(new Date).toISOString(),sessionMaxTime:t.s_i_d,sessionEnabled:t.s_s_s,customIdentifiersToTrack:t.src_ext,sessionExpiryTime:(new Date).getTime()+1e3*t.s_i_d,numberOfSessions:++n};o.default.set(a.default.SESSION_SOURCE.SESSION,r)}))},f.prototype.extendSession=function(){var e=this.getSession();e.sessionExpiryTime=(new Date).getTime()+1e3*e.sessionMaxTime,o.default.set(a.default.SESSION_SOURCE.SESSION,e)},f.prototype.handleBrowserInactivity=function(e){"hidden"===e&&l.default.set("wasBrowserInactive",!0)},f.prototype.isWindowActive=function(){return!!l.default.get("isWindowActive")},f.prototype.getNumberOfSessions=function(){return s.getProp(o.default.get(a.default.SESSION_SOURCE.SESSION),a.default.SESSION_SOURCE.NUMBER_OF_SESSIONS)||0},f.NON_INTERACTIVE_EVENTS=[a.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD,a.default.EVENT_NAMES.OPT_IN_SHOWN,a.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD,a.default.EVENT_NAMES.LOGOUT],f);function f(){}t.default=c},function(e,t,n){var r,o,a=n(14),i=n(15),u=0,s=0;e.exports=function(e,t,n){var l=t&&n||0,c=t||[],f=(e=e||{}).node||r,d=void 0!==e.clockseq?e.clockseq:o;if(null==f||null==d){var S=a();null==f&&(f=r=[1|S[0],S[1],S[2],S[3],S[4],S[5]]),null==d&&(d=o=16383&(S[6]<<8|S[7]))}var E=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:s+1,p=E-u+(g-s)/1e4;if(p<0&&void 0===e.clockseq&&(d=d+1&16383),(p<0||u<E)&&void 0===e.nsecs&&(g=0),1e4<=g)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=E,o=d;var _=(1e4*(268435455&(E+=122192928e5))+(s=g))%4294967296;c[l++]=_>>>24&255,c[l++]=_>>>16&255,c[l++]=_>>>8&255,c[l++]=255&_;var h=E/4294967296*1e4&268435455;c[l++]=h>>>8&255,c[l++]=255&h,c[l++]=h>>>24&15|16,c[l++]=h>>>16&255,c[l++]=d>>>8|128,c[l++]=255&d;for(var T=0;T<6;++T)c[l+T]=f[T];return t||i(c)}},function(e,t,n){var r=n(14),o=n(15);e.exports=function(e,t,n){var a=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var u=0;u<16;++u)t[a+u]=i[u];return t||o(i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),o=(a.isTokenValid=function(e,t){return new Promise((function(n,o){if(null!=e&&null!=t){var i="https://iid.googleapis.com/iid/info/"+e+"?details=true",u={headers:{authorization:"key="+t}};r.default.get(i,u).then((function(e){200===e.status?n(!0):n(!1)})).catch((function(r){0===r.code?setTimeout((function(){n(a.isTokenValid(e,t))}),3e3):n(!1)}))}else n(!1)}))},a);function a(){}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(13),a=n(1),i=n(31),u=n(4),s=n(0),l=a.default.PERSISTENT_STORAGE.Q,c=(f.clear=function(e){for(var t=f.baseLogTag+".clear",n=[],a=function(){switch(e){case l.REPORT:var a=o.default.dequeue(l.REPORT);n.push((function(e){u.default.reportAdd(a).then((function(){e()}))}));break;case l.DEVICE:o.default.dequeue(l.DEVICE)&&n.push((function(e){u.default.deviceAdd().then((function(){e()}))}));break;default:r.default.error(1,t,"Do not know how to handle queue with name:",e)}};!o.default.isEmpty(e);)a();setTimeout((function(){f.processing[e]=!0,i(n,5,(function(t,n){f.processing[e]=!1}))}),0)},f.startPeriodicClear=function(e){var t=f.baseLogTag+".startPeriodicCleanQ";function n(){o.default.isEmpty(e)?(r.default.log(1,t,"If you see multiple event tracks with same, they were captured over multiple visits or page refreshes."),s.getProp(f.processing,e,!1)||f.clearInterval(e)):(f.clear(e),r.default.log(1,t,"Starting periodic queue clear for",e))}f.clearInterval(e),n(),f.intervals[e]=setInterval(n,6e3)},f.clearInterval=function(e){null!=f.intervals[e]&&(clearInterval(f.intervals[e]),f.intervals[e]=null)},f.baseLogTag="QManager",f.intervals={},f.processing={},f);function f(){}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(26),a=n(18),i=n(3),u=n(16),s=n(10),l=(c.prototype.showHardAsk=function(){var e=this;return new Promise((function(t,n){e.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.EPHEMERAL_STORAGE,{requestType:"set",key:r.default.EPHEMERAL_STORAGE.INIT_DATA,value:s.default.get()}).then((function(o){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:r.default.PERSISTENT_STORAGE.INIT_DATA,value:s.default.get()}).then((function(o){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"get",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}).then((function(o){null!=o.message?e.isTokenValid().then((function(a){if(a)t({state:u.PERMISSION_STATE.GRANTED,subscriptionDetails:o.message});else{var i=n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}),s=e.removeToken();Promise.all([i,s]).then((function(){e.openNewTabForPermission(n).then((function(e){t(e)}))}))}})):e.openNewTabForPermission(n).then((function(e){t(e)}))}))}))}))}))}))},c.prototype.openNewTabForPermission=function(e){var t=this;return new Promise((function(n){e.sendMessage(r.default.HTML_COMM.TOPICS.CONFIG,t.sdkSettings).then((function(e){a.default.listenToChannel(r.default.HTML_COMM.CHANNEL.SUBD,r.default.HTML_COMM.TOPICS.HARD_ASK_RESULT,(function(e,t){t("Ok");var r=e.message;n(r)})),window.open(t.sdkSettings.platformSettings.chrome.subdomainURL+"?startSubscription=true","_blank","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=400,height=400")}))}))},c.prototype.getCurrentPermissionState=function(){var e=this;return new Promise((function(t,n){e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERMISSION_STATE,{requestType:"get"}).then((function(e){t(e.message)}))}))}))},c.prototype.getPushTokenDetails=function(){var e=this;return new Promise((function(t){e.getOrSetInSubDomainStorage(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS).then((function(e){t(e)}))}))},c.prototype.setInSubDomainStorage=function(e,t){var n=this;return new Promise((function(o){n.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:e,value:t}).then((function(e){o()}))}))}))},c.prototype.logout=function(){var e=this;return new Promise((function(t){e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"logout"}).then((function(e){t()}))}))}))},c.prototype.getInSubdomain=function(e){var t=this;return new Promise((function(n){t.getIframeCommunicator().then((function(t){t.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"get",key:e}).then((function(e){null==e.message?n(null):n(e.message)})).catch((function(e){n(null)}))})).catch((function(e){n(null)}))}))},c.prototype.setInSubdomain=function(e,t){var n=this;return new Promise((function(o,a){n.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"set",key:e,value:t}).then((function(e){o()})).catch((function(e){a(e)}))})).catch((function(e){a(e)}))}))},c.prototype.getOrSetInSubDomainStorage=function(e,t){var n=this;return new Promise((function(r){n.getInSubdomain(e).then((function(o){null==o?n.setInSubdomain(e,t).then((function(){r(t)})).catch((function(e){r(t)})):r(o)}))}))},c.prototype.isTokenValid=function(){var e=this;return new Promise((function(t){e.getPushTokenDetails().then((function(n){n&&n.token?o.default.isTokenValid(n.token,e.sdkSettings.platformSettings.chrome.apiKey).then((function(n){n?t(n):e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS}).then((function(){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS}).then((function(){t(n)}))}))}))})):t(!1)}))}))},c.prototype.removeToken=function(){var e=this;return new Promise((function(t){i.default.remove(r.default.PERSISTENT_STORAGE.PUSH_TOKEN),e.getIframeCommunicator().then((function(e){e.sendMessage(r.default.HTML_COMM.TOPICS.PERSISTENT_STORAGE,{requestType:"remove",key:r.default.PERSISTENT_STORAGE.PUSH_TOKEN}).then((function(e){t()}))}))}))},c.prototype.getIframeCommunicator=function(){var e=this;return new Promise((function(t){c.iframeCommunicator?t(c.iframeCommunicator):e.getIframe().then((function(e){c.iframeCommunicator=new a.default(r.default.HTML_COMM.CHANNEL.MAIN,e),t(c.iframeCommunicator)}))}))},c.prototype.getIframe=function(){var e=this;return new Promise((function(t,n){if(null==c.iframe){var r=document.createElement("iframe");r.id="moengage-subd-iframe",r.style.display="none",r.src=e.sdkSettings.platformSettings.chrome.subdomainURL,document.body.appendChild(r),(c.iframe=r).addEventListener("load",(function(){c.iframeLoaded=!0,t(r)}))}else c.iframeLoaded?t(c.iframe):setTimeout((function(){e.getIframe().then((function(e){t(e)}))}),500)}))},c.prototype.showNotification=function(e){var t=this;this.getIframeCommunicator().then((function(n){n.sendMessage(r.default.HTML_COMM.TOPICS.SHOW_NOTIF,{notification:e,config:t.sdkSettings})}))},c.baseLogTag="ChromeHTTPNotificationManager",c.iframeLoaded=!1,c);function c(e){var t=this;this.sdkSettings=e,this.getIframe(),a.default.listenToChannel(r.default.HTML_COMM.CHANNEL.SUBD,r.default.HTML_COMM.TOPICS.CONFIG,(function(e,n){n(t.sdkSettings)}))}t.default=l},,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(t){e.exports=function(e,n,r){if("number"!=typeof n)throw new Error("second argument must be a Number");var o,a,i,u,s,l=!0;function c(e){function n(){r&&r(e,o),r=null}l?t.nextTick(n):n()}function f(t,n,r){if(o[t]=r,n&&(s=!0),0==--i||n)c(n);else if(!s&&d<a){var l;u?(l=u[d],d+=1,e[l]((function(e,t){f(l,e,t)}))):(l=d,d+=1,e[l]((function(e,t){f(l,e,t)})))}}i=a=Array.isArray(e)?(o=[],e.length):(u=Object.keys(e),o={},u.length);var d=n;i?u?u.some((function(t,r){if(e[t]((function(e,n){f(t,e,n)})),r===n-1)return!0})):e.some((function(e,t){if(e((function(e,n){f(t,e,n)})),t===n-1)return!0})):c(null),l=!1}}).call(this,n(32))},function(e,t){var n,r,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var s,l=[],c=!1,f=-1;function d(){c&&s&&(c=!1,s.length?l=s.concat(l):f=-1,l.length&&S())}function S(){if(!c){var e=u(d);c=!0;for(var t=l.length;t;){for(s=l,l=[];++f<t;)s&&s[f].run();f=-1,t=l.length}s=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function E(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new E(e,t)),1!==l.length||c||u(S)},E.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.addEvent=function(e){o.history.push(e),o.listeners.forEach((function(t){t(e)}))},o.getHistory=function(){return o.history},o.addEventListener=function(e){o.listeners.push(e)},o.clear=function(){o.history=[]},o.history=[],o.listeners=[],o);function o(){}t.default=r},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=(a.getListeners=function(){return this.listeners},a.getTopicListeners=function(e){return r.getProp(a.topicListeners,e,[])},a.addListener=function(e){a.listeners.push(e)},a.addTopicListener=function(e,t){a.topicListeners[e]=a.getTopicListeners(e),a.topicListeners[e].push(t)},a.broadcast=function(e){a.listeners.map((function(t){t(e)})),r.getProp(a.topicListeners,e.topic,[]).map((function(t){t(e)}))},a.broadcastToWindow=function(e){window&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data?e.data:null}}))},a.deprecatedSdkCallback=function(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))},a.resetAllListeners=function(){a.listeners=[],a.topicListeners={}},a.listeners=[],a.topicListeners={},a);function a(){}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(2),a=n(3),i=n(9),u=n(7),s=n(8),l=n(4),c=n(46),f=n(16),d=n(47),S=n(21),E=n(12),g=n(0),p=n(43),_=(h.prototype.callWebPush=function(){var e=this,t=h.baseLogTag+".callWebPush";this.isWebPushEnabled()&&this.notificationManager.getCurrentPermissionState().then((function(n){function i(){s.default.get().then((function(i){var u=!1;null!=i.getAttribute("email")&&(u=!0),i.deviceAdded=u,i.save().then((function(){e.notificationManager.removeToken().then((function(){n===f.PERMISSION_STATE.DENIED?o.default.log(1,t,"Not asking for permission as current state is denied."):(a.default.remove(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME),e.startPushSubscription())}))}))}))}var l=a.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN);null==l&&n!==f.PERMISSION_STATE.DENIED?e.startPushSubscription():null!=l&&n===f.PERMISSION_STATE.DENIED?(o.default.log(1,t,"User has removed the permission"),o.default.image(1,r.default.GIFS.SAD),S.default.track(r.default.EVENT_NAMES.UNSUBSCRIBED,{Source:"Website"}).then((function(){i()}))):n===f.PERMISSION_STATE.DENIED?o.default.warn(1,t,"Not proceeding with push subscription as current state is denied"):null!=l&&n===f.PERMISSION_STATE.GRANTED?e.browser.name===u.default.BROWSER_NAMES.CHROME?g.isVapid(e.sdkSettings.platformSettings,e.browser)?e.startPushSubscription():e.notificationManager.isTokenValid().then((function(n){n?(e.startPushSubscription(),o.default.log(1,t,"Push token is valid"),e.notificationManager.getPushTokenDetails().then((function(e){o.default.customLabel(1,t,"token",e.token)}))):(o.default.warn(1,t,"Push token has expired. Trying to get a new token. This is a Chrome only feature."),i())})):(e.startPushSubscription(),e.notificationManager.getPushTokenDetails().then((function(e){o.default.customLabel(1,t,"token",e.token)}))):e.sdkSettings.isDomainLevelStorage?"granted"===E.default.get(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS)?o.default.log(1,t,"Not showing opt-in as user subscribed to sub-domain"):e.startPushSubscription():i()})).catch((function(e){o.default.error(1,t,"Error in getting current state:",e)}))},h.prototype.startPushSubscription=function(){function e(){a.default.set(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS,f.PERMISSION_STATE.PROMPT);var e=a.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN);t.notificationManager.showHardAsk().then((function(i){a.default.set(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS,i.state),i.state===f.PERMISSION_STATE.GRANTED?null!=i.subscriptionDetails.token?(a.default.set(r.default.PERSISTENT_STORAGE.PUSH_TOKEN,i.subscriptionDetails.token),a.default.set(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,i.subscriptionDetails),i.subscriptionDetails.token&&e!==i.subscriptionDetails.token&&l.default.deviceAdd().then((function(){o.default.image(1,r.default.GIFS.AMAZED),s.default.getSync().subscribedToOldSdk?o.default.log(1,n,"User subscribed from older sdk, hence not sending subscription event"):(null!=e?p.default.addAttribute("Web Migrated User","true"):(p.default.addAttribute("Web Push Preference","granted"),p.default.addAttribute("Web Subscription URL",location.href)),S.default.track(r.default.EVENT_NAMES.USER_SUBSCRIBED,{MOE_WEB_PUSH_TOKEN:i.subscriptionDetails.token}))})),t.sdkSettings.isDomainLevelStorage&&(E.default.set(r.default.PERSISTENT_STORAGE.SUBSCRIPTION_DETAILS,i.subscriptionDetails),E.default.set(r.default.PERSISTENT_STORAGE.PUSH_TOKEN,i.subscriptionDetails.token))):(o.default.error(1,n,"Push token was received as null."),o.default.error(1,n,"Please contact MoEngage support if this troubleshooting does not solve the issue.")):i.state===f.PERMISSION_STATE.DENIED&&o.default.image(1,r.default.GIFS.SAD)})).catch((function(e){o.default.warn(1,n,e)}))}var t=this,n=h.baseLogTag+".startPushSubscription";this.notificationManager.getCurrentPermissionState().then((function(u){if(u===f.PERMISSION_STATE.GRANTED)t.sdkSettings.optInConfig.type!==i.OptInConfig.TYPE.ONE_CLICK&&o.default.log(1,n,"Skipping soft ask as browser permission is set to allow all notifications"),e();else{var s=parseInt(a.default.get(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME)),l=a.default.get(r.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS),c=a.default.get(r.default.PERSISTENT_STORAGE.HARD_ASK_STATUS),S=(Date.now()-s)/36e5;if(!s||l===d.SoftAskState.SHOWN||l===d.SoftAskState.ALLOWED||c===f.PERMISSION_STATE.PROMPT||S>t.sdkSettings.optInConfig.reappearTime)t.softAskManager?t.softAskManager.showSoftAsk().then((function(t){t.showHardAsk&&e()})):o.default.log(1,n,"SoftAskManager not set.");else{var E,g=void 0;E=S<1?(g=Math.floor(60*S),"minute(s)"):(g=Math.floor(100*S)/100,"hour(s)"),o.default.log(1,n,"Not showing opt in as last it was shown",g,E,"back on",new Date(s),". Reappear time is set to",t.sdkSettings.optInConfig.reappearTime,"hours."),o.default.log(1,n,"You can clear localstorage to get opt-in again.")}}}))},h.prototype.isWebPushEnabled=function(){return i.default.isFeatureEnabled(this.sdkSettings,r.default.SDK_FEATURES.WEB_PUSH)&&!this.browser.isIncognito&&0<=h.SUPPORTED_BROWSERS.indexOf(this.browser.name)},h.prototype.getPermissionState=function(){return this.notificationManager.getCurrentPermissionState()},h.prototype.showNotification=function(e){this.notificationManager&&this.notificationManager.showNotification(e)},h.baseLogTag="WebPushManager",h.SUPPORTED_BROWSERS=[u.default.BROWSER_NAMES.CHROME,u.default.BROWSER_NAMES.FIREFOX,u.default.BROWSER_NAMES.OPERA],h);function h(e,t){this.notificationManager=null,this.softAskManager=null,this.sdkSettings=e,this.browser=t,this.softAskManager=new d.default(this.sdkSettings),this.notificationManager=new c.default(this.sdkSettings,t)}t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(26),o=n(1),a=n(2),i=n(7),u=n(9),s=n(3),l=n(16),c=n(10),f=n(4),d=n(0),S=n(21),E=(g.prototype.showHardAsk=function(){var e=this,t=g.baseLogTag+".showHardAsk";return new Promise((function(n,r){g.isWebPushSupported().then((function(i){i?e.getCurrentPermissionState().then((function(i){e.registerServiceWorker().then((function(u){i!==l.PERMISSION_STATE.DENIED?(a.default.log(1,t,"Attempting to open hard ask"),e.showOverlay(),e.askPermission().then((function(r){e.hideOverlay(),a.default.log(2,t,"Permission state after hard ask:",r),r===l.PERMISSION_STATE.GRANTED?e.getPushTokenDetails().then((function(t){e.sendDataToServiceWorker(t.token),n({state:r,subscriptionDetails:t})})):(e.sendDataToServiceWorker(),n({state:r,subscriptionDetails:null}))})).catch((function(e){a.default.error(1,t,e),r(o.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}))):(a.default.log(1,t,"Hard ask not shown as permission state is",i),n({state:i,subscriptionDetails:null}))})).catch((function(e){a.default.error(1,t,"Error registering serviceworker:",e),r(e)}))})).catch((function(e){a.default.error(1,t,"Registering service worker failed:",e),r(o.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):(a.default.warn(1,t,"Web push not supported in current browser environment"),r(o.default.ERRORS.WEB_PUSH_NOT_SUPPORTED))}))}))},g.prototype.sendDataToServiceWorker=function(e){return new Promise((function(t){f.default.collectGetParams().then((function(t){e&&(t.push_id=e||s.default.get(o.default.PERSISTENT_STORAGE.PUSH_TOKEN)||void 0),navigator.serviceWorker.ready.then((function(){navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({data:t}),navigator.serviceWorker.addEventListener("message",(function(e){e.data&&e.data.fn&&"trackEvent"===e.data.fn&&S.default.track(e.data.eventName,e.data.attrs)}))}))}))}))},g.prototype.getCurrentPermissionState=function(){return navigator.permissions?navigator.permissions.query({name:"notifications"}).then((function(e){return g.parsePermissionState(e.state)})).catch((function(e){})):new Promise((function(e){e(g.parsePermissionState(Notification.permission))}))},g.prototype.getPushTokenDetails=function(){var e=this,t=g.baseLogTag+".getPushTokenDetails";return new Promise((function(n,r){e.getCurrentPermissionState().then((function(r){r!==l.PERMISSION_STATE.GRANTED?n({token:null,raw:null}):i.default.getInstance().then((function(r){e.registerServiceWorker().then((function(o){var i=null,u={userVisibleOnly:!0};function s(){o.pushManager.subscribe(u).then((function(e){!function(e){var t=e.toJSON(),r=e.endpoint.substring(0,t.endpoint.lastIndexOf("/")+1),o=t.expirationTime,a=t.endpoint.split("/")[t.endpoint.split("/").length-1],i={};if(t.keys)for(var u in t.keys)t.keys.hasOwnProperty(u)&&(i[u]=t.keys[u]);n({token:a,endpoint:r,keys:i,expirationTime:o,raw:t})}(e)})).catch((function(e){a.default.error(1,t,"Error in subscribtion: ",e),n({token:null,raw:null})}))}d.isVapid(e.sdkSettings.platformSettings,r)&&(i=d.getVapidPublicKey(e.sdkSettings.platformSettings,r),u.applicationServerKey=d.stringToBuffer(i)),o.pushManager.getSubscription().then((function(t){if(t)if("vapid"===e.sdkSettings.platformSettings.chrome.subscriptionMode&&t.options&&t.options.applicationServerKey){var n=d.bufferToString(t.options.applicationServerKey);[i,i+"=",i+"==",d.bufferToString(d.stringToBuffer(i))].indexOf(n)<0?t.unsubscribe().then((function(){s()})):s()}else s();else s()}))})).catch((function(e){a.default.error(1,t,"Error in getting push token: ",e),n({token:null,raw:null})}))}))}))}))},g.prototype.isTokenValid=function(){var e=this;return this.getPushTokenDetails().then((function(t){return r.default.isTokenValid(t.token,e.sdkSettings.platformSettings.chrome.apiKey)}))},g.prototype.removeToken=function(){return s.default.remove(o.default.PERSISTENT_STORAGE.PUSH_TOKEN),Promise.resolve()},g.prototype.askPermission=function(){return new Promise((function(e,t){Notification.requestPermission().then((function(t){e(g.parsePermissionState(t))})).catch((function(e){t(o.default.ERRORS.PERMISSION_DISMISSED_TOO_MANY_TIMES)}))}))},g.prototype.registerServiceWorker=function(){var e=this,t=g.baseLogTag+".registerServiceWorker";return null!=this.swRegisterPromise||(this.swRegisterPromise=new Promise((function(n,r){if(g.registeredServiceWorker)n(g.registeredServiceWorker);else if("serviceWorker"in navigator){var i,s=void 0;i=c.default.get()&&null!=c.default.get().swPath?(s=c.default.get().swPath,!0):(s=e.sdkSettings.platformSettings.chrome.serviceWorkerFilename,!1);var l="/";if(c.default.get()&&null!=c.default.get().swScope)l=c.default.get().swScope;else if(e.sdkSettings.platformSettings.chrome.isServiceWorkerRoot)i&&(a.default.log(1,t,"Using user defined path to serviceworker:",s),l=s.substr(0,s.lastIndexOf("/")+1),g.canSwBeRegisteredWithScope(l)||(a.default.error(1,t,"Service worker can only be registered from same directory or child directory."),r(o.default.ERRORS.SERVICE_WORKER_NOT_IN_CORRECT_SCOPE)));else{var f=window.location.pathname;l=f.substring(0,f.lastIndexOf("/")+1)}"/"!==s[0]&&(s="/"+s),a.default.log(1,t,"Scope for serviceworker:",l),u.default.isFeatureEnabled(e.sdkSettings,o.default.SDK_FEATURES.WEB_PUSH)?navigator.serviceWorker.register(s,{scope:l}).then((function(e){a.default.log(2,t,"Serviceworker registered"),navigator.serviceWorker.ready.then((function(e){a.default.log(2,t,"Serviceworker ready"),g.registeredServiceWorker=e,c.default.get()&&c.default.get().forceSwUpdate&&e.update(),n(e)})).catch((function(e){a.default.error(1,t,"Service worker register failed:",e),r(o.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)}))})).catch((function(e){a.default.error(1,t,"Service worker register failed:",e),r(o.default.ERRORS.SERVICE_WORKER_REGISTRATION_FAILED)})):a.default.log(1,t,"Not registering serviceworker as web push is not enabled in current environment")}else a.default.error(1,t,"Service worker not supported"),r("Service worker not supported")}))),this.swRegisterPromise},g.canSwBeRegisteredWithScope=function(e){var t,n;return t=e,!((n=window.location.pathname).indexOf(t)<0)&&0<=n.substring(n.indexOf(t)).length},g.isWebPushSupported=function(){return new Promise((function(e){i.default.getInstance().then((function(t){t.isIncognito?e(!1):"serviceWorker"in navigator&&"PushManager"in window&&t.isChromeLike()?e(!0):e(!1)}))}))},g.parsePermissionState=function(e){return"prompt"===e?l.PERMISSION_STATE.PROMPT:"granted"===e?l.PERMISSION_STATE.GRANTED:"denied"===e?l.PERMISSION_STATE.DENIED:"default"===e?l.PERMISSION_STATE.DISMISSED:null},g.prototype.showNotification=function(e){var t=g.baseLogTag+".showNotification";this.registerServiceWorker().then((function(n){e?e.title?e.body?(null==e.requireInteraction&&(e.requireInteraction=!0),n.showNotification(e.title,e)):a.default.error(1,t,"Notification body can not be blank"):a.default.error(1,t,"Notification title can not be blank"):a.default.error(1,t,"Notification object can not be blank")})).catch((function(e){a.default.error(1,t,"Error registering serviceworker:",e)}))},g.prototype.showOverlay=function(){var e=this;if(this.sdkSettings.optInConfig.showOverlay){var t=document.createElement("div");t.id="moe-push-div",t.style.display="none",t.className="moe-push-class",i.default.getInstance().then((function(n){n.isMobile?t.innerHTML=e.sdkSettings.optInConfig.softAskConfig.mobile.customHTML:t.innerHTML=e.sdkSettings.optInConfig.softAskConfig.desktop.customHTML;var r=document.body.firstChild;r.parentNode.insertBefore(t,r);var o,a=n.name;if(a===i.default.BROWSER_NAMES.CHROME||a===i.default.BROWSER_NAMES.OPERA_NEON?o=document.getElementsByClassName("moe_chrome"):a===i.default.BROWSER_NAMES.FIREFOX?o=document.getElementsByClassName("moe_firefox"):a===i.default.BROWSER_NAMES.OPERA?o=document.getElementsByClassName("moe_opera"):a===i.default.BROWSER_NAMES.SAFARI&&(o=document.getElementsByClassName("moe_opera")),0===o.length)document.getElementById("moe-push-div").style.display="none";else for(var u=o.length-1;0<=u;u--)o[u].style.display="block";e.overlayTimer=window.setTimeout((function(){""===t.style.opacity&&(t.style.display="block")}),1500),t.onclick=function(){e.hideOverlay()}}))}},g.prototype.hideOverlay=function(){clearTimeout(this.overlayTimer);var e=document.getElementById("moe-push-div");null!=e&&(e.style.visibility="none",e.style.opacity="0",e.parentNode.removeChild(e))},g.baseLogTag="HTTPS-NotificationManager",g);function g(e){var t=this;this.swRegisterPromise=null;var n=g.baseLogTag+".constructor";this.sdkSettings=e,this.registerServiceWorker().then((function(e){t.sendDataToServiceWorker()})).catch((function(e){a.default.error(1,n,"Error registering serviceworker:",e)}))}t.default=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(o.addCallback=function(e,t){null!=e&&null!=t&&(null==o.callbacks[e]&&(o.callbacks[e]=[]),o.callbacks[e].push(t))},o.getCallbacks=function(e){return o.callbacks[e]||[]},o.runCallbacks=function(e){o.getCallbacks(e).forEach((function(e){e()}))},o.callbacks={},o);function o(){}t.default=r},,function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),i=n(19),u=n(27),s=n(2),l=n(36),c=n(4),f=n(42),d=n(3),S=n(7),E=n(8),g=n(9),p=n(10),_=n(37),h=n(16),T=n(44),m=n(33),v=n(23),b=n(49),A=function(){return new Promise((function(e){"complete"!==window.document.readyState?window.addEventListener("load",(function(){e()})):e()}))};window&&(window.moe=function(e){var n="Pre-Initialization";if(s.default.log(1,n,"Init data: ",e),"undefined"==typeof Promise)return s.default.error(1,n,"Promises not supported"),f.DummyMoengageObject;if(e.app_id||e.appId){p.default.save(e),A().then((function(){l.default.broadcastToWindow({topic:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.EVENT_NAMES.MOE_INIT,data:p.default.get()}),i.createInstance({driver:[i.INDEXEDDB,i.WEBSQL,i.LOCALSTORAGE],name:a.default.EVENTS.DATABASE_NAME,storeName:a.default.EVENTS.STORE_NAME}).clear(),s.default.setLogLevel(p.default.get().debugLevel),s.default.log(1,n,"Script loaded!"),s.default.customLabel(1,n,"SDK Version","2.5.5"),0<p.default.get().debugLevel&&(s.default.warn(1,n,"You are currently using MoEngage in debug environment. You'll find all the data captured in this environment in the TEST mode on the dashoard."),s.default.warn(1,n,"Please initialize with debugLevel as",0,"when using on your production environment.")),t.initializeLaunchSequence()}));var r=window.moengage_object||"Moengage";return window[r]=f.default,f.default}return s.default.error(1,n,"App Id not specified. Please check docs page to complete the integration - ",a.default.LINKS.WEBSDK_DOCS),f.DummyMoengageObject},window.moeBannerText="banner",window[a.WINDOW_OBJECTS.PageEventHistroyManager]=m.default),t.initializeLaunchSequence=function(){var e="Initialization";return new Promise((function(t){c.default.getWebSDKSettings().then((function(n){n.isDomainLevelStorage&&(d.default.isSharedWithCookie=!0,d.default.copyKeysFromCookie()),E.default.get().then((function(r){if(T.default.get().deviceToLogout===r.deviceUuid)return s.default.log(1,e,"User was not able to logout last time. Completing the logout now and starting new session."),f.default.user.logout();r.deviceAdded&&c.default.onDeviceAdd.res(),n.isPushSubBilling&&s.default.warn(1,e,"You are under push subscriber based billing plan. We are only tracking users with an email or have subscribed to web push. All user attributes and events will be stored in a queue till we receive either of the properties.");var o=new v.default;(new b.default).onWindowVisibilityChange(o.handleBrowserInactivity),s.default.customLabel(1,e,"Device UUID",r.deviceUuid),s.default.customLabel(1,e,"Device Added",r.deviceAdded),l.default.broadcastToWindow({topic:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.EVENT_NAMES.SETTINGS_FETCHED,data:n}),n.isPushSubBilling||r.deviceAdded||c.default.deviceAdd(),f.default.event.track(a.default.EVENT_NAMES.WEB_SESSION_START,{timestamp:Number(Date.now())}),f.default.event.track(a.default.EVENT_NAMES.PAGE_VIEWED,{timestamp:Number(Date.now())}),u.default.clear(a.default.PERSISTENT_STORAGE.Q.DEVICE),u.default.clear(a.default.PERSISTENT_STORAGE.Q.REPORT),S.default.getInstance().then((function(t){var r=new _.default(n,t);r.isWebPushEnabled()?0<=[g.OptInConfig.TYPE.ONE_CLICK,g.OptInConfig.TYPE.TWO_STEP].indexOf(n.optInConfig.type)||d.default.get(a.default.PERSISTENT_STORAGE.PUSH_TOKEN)?r.callWebPush():(s.default.log(1,e,"Self handled setting. Will show opt-in on manual invocation, if required."),r.getPermissionState().then((function(t){t===h.PERMISSION_STATE.GRANTED&&(s.default.log(1,e,"Notification permission already granted. Proceeding to subscribe the user"),r.callWebPush())})).catch((function(t){s.default.warn(1,e,"Cannot get permission state: ",t)}))):t.isIncognito?s.default.warn(1,e,"Web push not supported in incognito mode"):_.default.SUPPORTED_BROWSERS.indexOf(t.name)<0?s.default.warn(1,e,"Web push not supported on this browser. Supported browsers are:\n\t\t1. Google Chrome\n\t\t2. Mozilla Firefox\n\t\t3. Opera"):s.default.warn(1,e,"Web push feature not enabled for current environment"),!p.default.get().disableOnsite&&n.inappEnabled?c.default.onDeviceAdd.p.then((function(){f.enableOnsiteApi(n)})):s.default.warn(1,e,"Onsite is disabled in this page since `disableOnsite: true` is passed during initialization."),I()})),t()}))}))}))};var I=function(){var e="Moengage.clearWindowQ";A().then((function(){var t,n;try{var r=window.moengage_object||"Moengage";if(window[r]&&window.moengage_q){var a=window.moengage_q;if(window.moengage_q=[],a&&0<a.length&&window[r])for(var i=0;i<a.length;i++){s.default.log(1,e,"Method called before SDK downloaded:",[a[i].f],a[i].a);var u=a[i].f;"onsite.getData"===u?(t=f.default.onsite).getData.apply(t,o(a[i].a)):"onsite.registerCallback"===u?(n=f.default.onsite).registerCallback.apply(n,o(a[i].a)):null!=f.default[a[i].f]&&f.default[a[i].f].apply(null,a[i].a)}a=[]}}catch(t){s.default.error(1,e,t)}}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),i=n(2),u=n(3),s=n(4),l=n(7),c=n(9),f=n(45),d=n(43),S=n(21),E=n(4),g=n(37),p=n(39),_=n(8),h=n(10),T=n(0),m=n(48),v="MoEngage",b=new T.PromiseObject,A={getData:function(e,t){var n=v+".onsite.getData";E.default.getWebSDKSettings().then((function(r){r.inappEnabled?b.p.then((function(n){n.getData(e,t)})).catch((function(e){i.default.error(1,n,"Error adding onsite module"),i.default.error(1,n,e)})):(i.default.log(1,n,"Onsite service not yet enabled for this app"),t({message:"Onsite service not enabled on MoEngage dashboard"},null))}))},registerCallback:function(e,t){var n=v+".onsite.registerCallback";E.default.getWebSDKSettings().then((function(r){r.inappEnabled?b.p.then((function(n){n.registerCallback(e,t)})).catch((function(e){i.default.error(1,n,"Error adding onsite module"),i.default.error(1,n,e)})):(i.default.log(1,n,"Onsite service not yet enabled for this app"),t({message:"Onsite service not enabled on MoEngage dashboard"},null))}))}},I=(O.callWebPush=function(e){var t=v+".callWebPush";s.default.getWebSDKSettings().then((function(n){if(n.isConfigured)if(c.default.isFeatureEnabled(n,a.default.SDK_FEATURES.WEB_PUSH))if(n.optInConfig.type===c.OptInConfig.TYPE.SELF_HANDLED){if(i.default.log(1,t,"Starting web push functions"),null!=e){h.default.setSoftAskConfig(e);var r=T.getProp(e,"soft_ask_display_callback",null),o=T.getProp(e,"soft_ask_allow_callback",null),u=T.getProp(e,"soft_ask_block_callback",null),s=T.getProp(e,"hard_ask_allow_callback",null),f=T.getProp(e,"hard_ask_dismiss_callback",null),d=T.getProp(e,"hard_ask_block_callback",null),S=a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES;p.default.addCallback(S.SOFT_ASK_SHOWN,r),p.default.addCallback(S.SOFT_ASK_ALLOWED,o),p.default.addCallback(S.SOFT_ASK_DISMISSED,u),p.default.addCallback(S.HARD_ASK_ALLOWED,s),p.default.addCallback(S.HARD_ASK_DISMISSED,f),p.default.addCallback(S.HARD_ASK_DENIED,d)}l.default.getInstance().then((function(e){new g.default(n,e).callWebPush()}))}else i.default.warn(1,t,"This feature can only be used when you have chosed self-handled approach in the dashboard. You can check dashboard here:","https://app.moengage.com/v3/#/settings/4/0");else i.default.warn(1,t,"Web push feature not enabled for current environment.");else i.default.log(1,t,"Web push settings not configured on dashboard yet. To start web push subscriptions, please configure the settings on dashboard.")}))},O.showNotification=function(e){E.default.getWebSDKSettings().then((function(t){l.default.getInstance().then((function(n){new g.default(t,n).showNotification(e)}))}))},O.getSdkVersion=function(){return"2.5.5"},O.setDebugLevel=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,u;return o(this,(function(o){switch(o.label){case 0:t=v+".setDebugLevel",o.label=1;case 1:return o.trys.push([1,9,,10]),[4,E.default.getWebSDKSettings()];case 2:return n=o.sent(),(r=n.inappEnabled&&!h.default.get().disableOnsite)?[4,_.default.get()]:[3,4];case 3:r=o.sent().deviceAdded,o.label=4;case 4:if(!r)return[3,8];o.label=5;case 5:return o.trys.push([5,7,,8]),[4,b.p];case 6:return o.sent().setLogLevel(e),[3,8];case 7:return a=o.sent(),i.default.error(1,t,"Error setting debug level in inapp module",a),[3,8];case 8:return"number"==typeof e&&i.default.setLogLevel(e,!0),[3,10];case 9:return u=o.sent(),i.default.error(0,t,"Error changing log level:",u),[3,10];case 10:return[2]}}))}))},O.vitals=function(){var e=_.default.getSync();return{deviceUuid:e.deviceUuid,userDetails:e,pushToken:u.default.get(a.default.PERSISTENT_STORAGE.PUSH_TOKEN),softAskStatus:u.default.get(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS),hardAskStatus:u.default.get(a.default.PERSISTENT_STORAGE.HARD_ASK_STATUS)}},O.help=function(){var e=v+".help";for(var t in i.default.log(0,e,"Moengage Dashboard - ",a.default.LINKS.MOE_DASHBOARD),a.default.LINKS)a.default.LINKS.hasOwnProperty(t)&&i.default.log(0,e,t,"-",a.default.LINKS[t])},O.track_event=function(e,t){return S.default.track(e,t)},O.add_unique_user_id=function(e){return d.default.login(e)},O.update_unique_user_id=function(e){return d.default.updateUniqueId(e)},O.add_user_attribute=function(e,t){return d.default.addAttribute(e,t)},O.add_first_name=function(e){return d.default.addAttribute("first_name",e)},O.add_last_name=function(e){return d.default.addAttribute("last_name",e)},O.add_email=function(e){return d.default.addAttribute("email",e)},O.add_mobile=function(e){return d.default.addAttribute("mobile",e)},O.add_user_name=function(e){return d.default.addAttribute("name",e)},O.add_gender=function(e){return d.default.addAttribute("gender",e)},O.add_birthday=function(e){return d.default.addAttribute("birthday",e)},O.destroy_session=function(){return O.user.logout()},O.call_web_push=function(e){O.callWebPush(e)},O.getBranch=function(){return a.default.BRANCH},O.user=d.default,O.event=S.default,O.device=f.default,O.onsite=A,O);function O(){}function y(){}t.default=I,t.DummyMoengageObject={track_event:y,add_user_attribute:y,add_first_name:y,add_last_name:y,add_email:y,add_mobile:y,add_user_name:y,add_gender:y,add_birthday:y,destroy_session:y,add_unique_user_id:y,moe_events:y,location_type_attribute:y,call_web_push:y},t.enableOnsiteApi=function(e){m.default.loadModule(a.SDK_MODULES.INAPP).then((function(e){b.res(e),e.initialize(),I.onsite=e})).catch((function(e){b.rej(e)}))},t.disableOnsiteApi=function(e){return r(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:t="Moengage.disableOnsiteApi",r.label=1;case 1:return r.trys.push([1,5,,6]),e.inappEnabled?[4,m.default.loadModule(a.SDK_MODULES.INAPP)]:[3,4];case 2:return[4,r.sent().logout()];case 3:r.sent(),b=new T.PromiseObject,I.onsite=A,r.label=4;case 4:return[3,6];case 5:return n=r.sent(),i.default.error(1,t,"Error logging out from inapp module:",n),[3,6];case 6:return[2]}}))}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n=n||Promise)((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(i,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),i=n(2),u=n(3),s=n(41),l=n(4),c=n(11),f=n(22),d=n(20),S=n(8),E=n(12),g=n(21),p=n(44),_=n(33),h=n(42),T="MoEngage.user",m=(v.addAttribute=function(e,t){var n=T+".addUserAttribute";return new Promise((function(r,o){if("string"!=typeof e||null==e)i.default.error(1,n,"Attribute name needs to be a string"),r({error:5e3,message:"Attribute name needs to be a string. Type provided was "+typeof e});else if(""===e)i.default.error(1,n,"Attribute name can not be an empty string"),r({error:5001,message:"Attribute name can not be an empty string"});else if(null==t)i.default.error(1,n,"Attribute value null"),r({error:5003,message:"Attribute value was empty"});else if("string"==typeof t&&""===t)r({error:5004,message:"Attribute value needs to be non-empty string or a date object"});else if("object"==typeof t&&"function"!=typeof t.getMonth)r({error:5005,message:"Attribute value needs to be non-empty string or a date object"});else{var a=new c.default(e,t),u=function(){S.default.get().then((function(e){e.addAttribute(a).then((function(e){e?("id"===a.key&&i.default.log(1,n,"Logging in the user with id: ",a.value),f.default.createUserAttributeEvent(a).then((function(e){i.default.log(2,n,"Event to be converted to report:",e),_.default.addEvent(e),l.default.collectGetParams().then((function(t){var n=new d.default(d.default.REPORT_ADD_TYPE.USER_ATTRIBUTE,t,e);l.default.reportAdd(n).then((function(){r()}))}))}))):(i.default.log(1,n,"Attribute already present/queued. Not adding again."),r({error:5005,message:"Attribute already present/queued. Not adding again."}))}))}))};"id"===e?S.default.get().then((function(e){var o=e.indexOfAttribute("id");-1<o?t===e.attributes[o].value?(i.default.log(1,n,"User already logged in with id:",t),r()):(i.default.log(1,n,"Logging out previous user with id:",e.attributes[o].value),v.logout(!0,t).then((function(){u()}))):u()})):u()}}))},v.login=function(e){return v.addAttribute("id",e)},v.logout=function(e,t){var n,c=this,f=e?{type:"forced",new_uid:t}:null;return n=p.default.get(),null!=S.default.getSync()&&(n.deviceToLogout=S.default.getSync().deviceUuid,n.save()),new Promise((function(e){g.default.track(a.default.EVENT_NAMES.LOGOUT,f).then((function(){i.default.log(1,"MoEngage.user.logout","Logging out now!"),l.default.getWebSDKSettings().then((function(t){return r(c,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return t.isDomainLevelStorage&&E.default.remove(a.default.PERSISTENT_STORAGE.USER_DATA),_.default.clear(),[4,h.disableOnsiteApi(t)];case 1:return n.sent(),u.default.logout(),[4,S.default.logout()];case 2:return n.sent(),u.default.remove(a.default.PERSISTENT_STORAGE.GRACEFUL_DATA),[4,s.initializeLaunchSequence()];case 3:return n.sent(),e(),[2]}}))}))}))}))}))},v.updateUniqueId=function(e){var t=T+".updateUniqueId";return new Promise((function(n){S.default.get().then((function(r){var o=r.indexOfAttribute(a.default.ATTRIBUTE_NAMES.ID),u=r.indexOfAttribute("oldUniqueIds");if(!(-1<o))return i.default.log(2,t,"Logging in as no id found"),v.login(e);var s=r.attributes[o].value;e!==s?(i.default.log(2,t,"Different ids found"),-1<u?(r.attributes[u].value.push(s),r.attributes.splice(o,1)):(r.attributes.splice(o,1),r.addAttribute(new c.default("oldUniqueIds",[s]))),r.save().then((function(){v.login(e).then((function(){n()}))}))):(i.default.warn(1,t,"New id and old id are the same. Not updating the id."),n())}))}))},v.getAttributes=function(){var e=S.default.getSync().attributes,t={};return e.map((function(e){t[e.key]=e.value})),t},v);function v(){}t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(1),a=n(0),i=(u.get=function(){return new u(r.default.get(o.default.PERSISTENT_STORAGE.GRACEFUL_DATA))},u.prototype.save=function(){r.default.set(o.default.PERSISTENT_STORAGE.GRACEFUL_DATA,this)},u);function u(e){this.deviceToLogout=a.getProp(e,"deviceToLogout",null)}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(7),a=n(3),i=n(4),u=n(37),s=(l.getUuid=function(){return a.default.get(r.default.PERSISTENT_STORAGE.USER_DATA).deviceUuid},l.getPushToken=function(){return a.default.get(r.default.PERSISTENT_STORAGE.PUSH_TOKEN)},l.getPermissionState=function(e){return new Promise((function(t,n){i.default.getWebSDKSettings().then((function(r){o.default.getInstance().then((function(o){new u.default(r,o).getPermissionState().then((function(n){t(n),e&&e(null,n)})).catch((function(t){n(t),e&&e(t,null)}))}))}))}))},l);function l(){}t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(2),a=n(0),i=n(36),u=n(7),s=n(9),l=n(3),c=n(21),f=n(28),d=n(38),S=n(16),E=n(39),g="Web push settings not configured on MoEngage dashboard: "+r.default.LINKS.MOE_DASHBOARD,p=(_.prototype.showHardAsk=function(){var e=this,t=_.baseLogTag+".showHardAsk";return new Promise((function(n,a){e.getCurrentPermissionState().then((function(u){null!=e.currentManager?u===S.PERMISSION_STATE.PROMPT?(l.default.set(r.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,Date.now()),c.default.track(r.default.EVENT_NAMES.OPT_IN_SHOWN),i.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_SHOWN}),i.default.deprecatedSdkCallback("opt_in_shown"),E.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_SHOWN),e.currentManager.showHardAsk().then((function(e){e.state===S.PERMISSION_STATE.DISMISSED?(c.default.track(r.default.EVENT_NAMES.OPT_IN_DISMISSED),i.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DISMISSED}),i.default.deprecatedSdkCallback("opt_in_dismissed"),E.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DISMISSED),o.default.log(1,t,"Hard ask was dismissed")):e.state===S.PERMISSION_STATE.GRANTED?(c.default.track(r.default.EVENT_NAMES.OPT_IN_ALLOWED),i.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_ALLOWED,data:e.subscriptionDetails}),i.default.deprecatedSdkCallback("opt_in_allowed"),E.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_ALLOWED),o.default.log(1,t,"Push permission was granted"),o.default.customLabel(1,t,"token",e.subscriptionDetails.token)):e.state===S.PERMISSION_STATE.DENIED&&(c.default.track(r.default.EVENT_NAMES.OPT_IN_BLOCKED),c.default.track("Web Push Opt-in Denied"),i.default.broadcastToWindow({topic:r.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DENIED}),i.default.deprecatedSdkCallback("opt_in_blocked"),E.default.runCallbacks(r.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.HARD_ASK_DENIED),o.default.log(1,t,"Notification permission was denied")),n(e)})).catch((function(e){o.default.error(1,t,"Error showing hard ask:",e),n({state:u,subscriptionDetails:null})}))):(o.default.log(1,t,"Not showing Hard Ask as current permission state is",u),e.getPushTokenDetails().then((function(e){o.default.customLabel(1,t,"token",e.token),n({state:u,subscriptionDetails:e})})).catch((function(e){o.default.warn(1,t,"Could not get push token details"),n({state:u,subscriptionDetails:null})}))):(o.default.log(1,t,"MoEngage web push settings not configured. Please configure at","https://app.moengage.com/v3/#/settings/4/0"),a(r.default.ERRORS.WEB_PUSH_NOT_CONFIGURED))})).catch((function(e){a(e)}))}))},_.prototype.getCurrentPermissionState=function(){return null!=this.currentManager?this.currentManager.getCurrentPermissionState():Promise.reject(g)},_.prototype.getPushTokenDetails=function(){return null!=this.currentManager?this.currentManager.getPushTokenDetails():Promise.reject(g)},_.prototype.isTokenValid=function(){return null!=this.currentManager?this.currentManager.isTokenValid():Promise.reject(g)},_.prototype.removeToken=function(){return null!=this.currentManager?this.currentManager.removeToken():Promise.reject(g)},_.prototype.showNotification=function(e){var t=_.baseLogTag+".showNotification";if(null!=this.currentManager)return this.currentManager.showNotification(e);o.default.warn(1,t,g)},_.baseLogTag="NotificationManager",_);function _(e,t){this.currentManager=null;var n=_.baseLogTag+".constructor";this.config=e,(this.browser=t).isIncognito?(this.currentManager=null,o.default.warn(1,n,"Web push not supported in incognito mode")):this.browser.isChromeLike()&&e.platformSettings.chrome?(e.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.HTTPS?"http"===a.getCurrentProtocol()?o.default.error(1,n,"Domain configured as a HTTPS site and this is a HTTP site. Please update correct settings at",r.default.LINKS.MOE_DASHBOARD):this.currentManager=new d.default(e):e.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.HTTP?this.currentManager=new f.default(e):e.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.MUTLI&&("https"===a.getCurrentProtocol()?this.currentManager=new d.default(e):this.currentManager=new f.default(e)),!1===e.platformSettings.chrome.enabled&&o.default.warn(1,n,"Web push settings not configured. Please configure at ",r.default.LINKS.MOE_DASHBOARD)):this.browser.name===u.default.BROWSER_NAMES.SAFARI&&e.platformSettings.safari&&"safari"in window&&"pushNotification"in window.safari&&(this.currentManager=null,o.default.warn(1,n,"Web push support for Safari will be coming soon. Please try on Chrome, Opera or Firefox."))}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,a=n(1),i=n(2),u=n(7),s=n(9),l=n(36),c=n(3),f=n(21),d=n(10),S=n(0),E=n(39),g=(p.prototype.showSoftAsk=function(){var e=this,t=p.baseLogTag+".showSoftAsk";return new Promise((function(n,o){var d=e.config.optInConfig.loadTime;e.config.optInConfig.type===s.OptInConfig.TYPE.SELF_HANDLED&&(d=0),d&&i.default.log(1,t,"Delay of",d," second(s) requested before opt-in flow"),setTimeout((function(){u.default.getInstance().then((function(o){function u(){c.default.set(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.NOT_SHOWN),n({showHardAsk:!0,softAskState:r.NOT_SHOWN})}o.isChromeLike()&&"https"===S.getCurrentProtocol()&&e.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.MUTLI?u():e.config.optInConfig.type===s.OptInConfig.TYPE.TWO_STEP||e.config.optInConfig.type===s.OptInConfig.TYPE.SELF_HANDLED?e.showOptIn((function(){i.default.log(1,t,"Soft ask was shown"),c.default.set(a.default.PERSISTENT_STORAGE.OPT_IN_SHOWN_TIME,Date.now()),c.default.set(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.SHOWN),l.default.broadcastToWindow({topic:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_SHOWN}),l.default.deprecatedSdkCallback("soft_ask_shown"),E.default.runCallbacks(a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_SHOWN)}),(function(){f.default.track(a.default.EVENT_NAMES.WEB_OPTIN_ACCEPTED),e.hideOptIn(),i.default.log(1,t,"Soft ask was allowed"),c.default.set(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.ALLOWED),n({showHardAsk:!0,softAskState:r.ALLOWED}),l.default.broadcastToWindow({topic:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_ALLOWED}),l.default.deprecatedSdkCallback("soft_ask_allowed"),E.default.runCallbacks(a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_ALLOWED)}),(function(){e.hideOptIn(),f.default.track(a.default.EVENT_NAMES.WEB_OPTIN_CLOSED),i.default.log(1,t,"Soft ask was dismissed"),c.default.set(a.default.PERSISTENT_STORAGE.SOFT_ASK_STATUS,r.DISMISSED),n({showHardAsk:!1,softAskState:r.DISMISSED}),l.default.broadcastToWindow({topic:a.default.BROADCAST_TOPICS.MOE_LIFECYCLE.TOPIC_NAME,name:a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_DISMISSED}),l.default.deprecatedSdkCallback("soft_ask_closed"),E.default.runCallbacks(a.default.BROADCAST_TOPICS.OPT_IN_LIFECYCLE.EVENT_NAMES.SOFT_ASK_DISMISSED)}),(function(t){t=!!t,e.hideOptIn(),n({showHardAsk:t,softAskState:r.NOT_SHOWN})})):u()}))}),1e3*d)}))},p.prototype.showOptIn=function(e,t,n,r){var o=this,l=p.baseLogTag+".showOptIn";if(this.config.optInConfig.type===s.OptInConfig.TYPE.TWO_STEP){var c=document.getElementById("moe-push-div");null==c&&((c=document.createElement("div")).id="moe-push-div"),c.className="moe-push-class",u.default.getInstance().then((function(u){var s;if(null!=(s=u.isMobile?o.config.optInConfig.softAskConfig.mobile.customHTML:o.config.optInConfig.softAskConfig.desktop.customHTML)){c.innerHTML=s;var d=document.body.firstChild;d.parentNode.insertBefore(c,d),o.moeDiv=c;var S=document.getElementById("optInText")||document.getElementById("optInTextConventional");null==S?(i.default.error(1,l,"Error showing soft ask. Allow button id is missing"),r()):(e(),f.default.track(a.default.EVENT_NAMES.WEB_OPTIN_BANNER_LOAD),S.onclick=function(){t()},window.moeRemoveBanner=function(){n()})}else i.default.error(1,l,"Error displaying soft ask"),r()}))}else if(this.config.optInConfig.type===s.OptInConfig.TYPE.SELF_HANDLED){var E=d.default.get();if(E.customSoftAsk){var g=document.getElementsByClassName(E.customSoftAsk.mainClass),_=document.getElementsByClassName(E.customSoftAsk.allowClass),h=document.getElementsByClassName(E.customSoftAsk.dismissClass);if(g.length<1)i.default.error(1,l,"Could not find main class for the soft ask. Class name given:",E.customSoftAsk.mainClass),u.default.getInstance().then((function(e){(e.isChromeLike()&&o.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.HTTPS||o.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.MUTLI&&"https"===S.getCurrentProtocol()||e.name===u.default.BROWSER_NAMES.SAFARI)&&(i.default.warn(1,l,"Proceeding to hard ask directly"),r(!0))}));else{e(),_.length<1&&(i.default.warn(1,l,"Could not find any element for allow button. Class name given:",E.customSoftAsk.allowClass),i.default.warn(1,l,"Docs for self-handled opt in available here - ",a.default.LINKS.SELF_HANDLED_DOCS)),h.length<1&&i.default.warn(1,l,"Could not find any element for dismiss button. Class name given:",E.customSoftAsk.dismissClass);for(var T=g.length-1;0<=T;T--){var m=g[T];this.mainDivs.push(m),m.style.display="block"}for(T=_.length-1;0<=T;T--)(m=_[T]).onclick=function(){t()};for(T=h.length-1;0<=T;T--)(m=h[T]).onclick=function(){n()}}}else u.default.getInstance().then((function(e){e.isChromeLike()&&o.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.HTTPS||o.config.platformSettings.chrome.domainType===s.ChromeConfig.DOMAIN_TYPE.MUTLI&&"https"===S.getCurrentProtocol()||e.name===u.default.BROWSER_NAMES.SAFARI?(i.default.warn(1,l,"No soft ask configured. Proceeding to hard ask directly. \n\nYou can ignore this message if you do not want any soft ask."),r(!0)):(i.default.error(1,l,"Soft ask needs to be present in case of http implementation. Can not show hard ask otherwise."),r())}))}},p.prototype.hideOptIn=function(){null!=this.moeDiv&&(this.moeDiv.style.display="none"),0<this.mainDivs.length&&this.mainDivs.map((function(e){e.style.display="none"}))},p.baseLogTag="SoftAskManager",p);function p(e){this.mainDivs=[],this.config=e}t.default=g,(o=r=t.SoftAskState||(t.SoftAskState={})).SHOWN="shown",o.NOT_SHOWN="not shown",o.ALLOWED="allowed",o.DISMISSED="dismissed"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(2),a=n(10),i=(u.loadModule=function(e){var t=u.baseLogTag+".loadModule";return null!=u.loadPromises[e.name]||(o.default.log(1,t,"Starting to fetch module: ",e.name),u.loadPromises[e.name]=new Promise((function(t,n){u.addScript(e.src,(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=new window[r.SDK_MODULES.INAPP.windowLocation](a.default.get());t(o)}))}))),u.loadPromises[e.name]},u.addScript=function(e,t){var n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.async=!0,document.body.appendChild(n)},u.baseLogTag="ModuleManager",u.loadPromises={},u);function u(){}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0),a=n(5),i=(u.prototype.onWindowVisibilityChange=function(e){var t=u.baseLogTag+".onWindowBlur";a.default.set("isWindowActive",!0),document.addEventListener("focus",(function(){n(!0)}),!1),document.addEventListener("blur",(function(){n(!1)}),!1),window.addEventListener("focus",(function(){n(!0)}),!1),window.addEventListener("blur",(function(){"IFRAME"!==document.activeElement.tagName&&n(!1)}),!1);var n=function(e){return"boolean"==typeof e?i(e?"visible":"hidden"):document.hidden?i("hidden"):i("visible")},i=o.debounce((function(n){r.default.log(1,t,"TRIGGERED: Window visibilitychange event: "+n.toUpperCase()),a.default.set("isWindowActive","visible"===n),e(n)}),250);window.addEventListener("visibilitychange",n,!1)},u.baseLogTag="WindowEventManager",u);function u(){}t.default=i}]);